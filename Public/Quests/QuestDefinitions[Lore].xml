<?xml version="1.0" encoding="utf-8" ?>
<Datatable xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">


  <!--=====================================
   ========================================
   ============= LORE QUESTS ==============
   ========================================
   ========================================-->

  <!-- ============ Mask of the Delvers / Delvers ============-->
  <QuestDefinition Name="SideQuestLore#0001" Category="SideQuest" SubCategory="Minor"
                     Cooldown="7" SkipLockedQuestTarget="true" NumberOfConcurrentInstances="1" NumberOfOccurencesPerEmpire="1" NumberOfOccurencesPerGame="0">

    <!--============ TAGS ============-->
    <Tags>Talk</Tags>

    <!--Prerequisite-->
    <Prerequisites Target="$(Empire)">
      <DownloadableContentPrerequisite Flags="Prerequisite">LoreQuestsPack</DownloadableContentPrerequisite>
    </Prerequisites>

    <!--============ VARIABLES============-->
    <Vars>
      <Var VarName="$InstigatorEmpire">
        <From Source="$Empire"/>
      </Var>

      <!--Check the number of pacified villages as prerequisite-->
      <Var VarName="$InitialTribeRegion">
        <From Source="$TargetVillage.$PointOfInterest.$Position.$Region"/>
      </Var>

      <Var VarName="$StateOfMinorEmpire">
        <From Source="$InitialTribeRegion.$MinorEmpire">
          <Where>
            <InterpreterPrerequisite Flags="Prerequisite">$Count(ClassEmpire/MinorEmpireVillage,!PacifiedVillage) ge 2</InterpreterPrerequisite>
            <InterpreterPrerequisite Flags="Prerequisite">$Count(ClassEmpire/MinorEmpireVillage,!ConvertedVillage) ge 2</InterpreterPrerequisite>
          </Where>
        </From>
      </Var>

      <Var VarName="$InitialVillagesPointOfInterests">
        <From Source="$InitialTribeRegion.$Villages.$PointOfInterest"/>
      </Var>

      <Var VarName="$InitialVillage">
        <From Source="$TargetVillage">
          <Where>
            <PathPrerequisite Inverted="true" Flags="Prerequisite">PacifiedVillage</PathPrerequisite>
            <PathPrerequisite Inverted="true" Flags="Prerequisite">ConvertedVillage</PathPrerequisite>
          </Where>
        </From>
      </Var>

      <Var VarName="$Tribe">
        <From Source="$InitialVillage.$MinorEmpire">
          <Where>
            <PathPrerequisite Flags="Prerequisite">AffinityDelvers</PathPrerequisite>
          </Where>
        </From>
      </Var>

      <Var VarName="$InitialVillagePointOfInterest">
        <From Source="$TargetPointsOfInterest"/>
      </Var>

      <LocalizationVar LocalizationKey="$MinorFaction" Source="$Tribe"/>
      <LocalizationVar LocalizationKey="$InitialTribeRegionName" Source="$InitialTribeRegion"/>

    </Vars>

    <!--============ SEQUENCE ============-->

    <Controller_Sequence>
      <Action_UpdateStep StepName="SideQuestLore#0001-Step1" State="InProgress" />

      <Controller_Parallel CompletionPolicy ="Any">

        <!--Step 1-->
        <Controller_Sequence>
          <Controller_Loop LoopCount="2">
            <Decorator_BoosterActivated Initiator="Empire" LinkedStepProgression="SideQuestLore#0001-Step1"/>
          </Controller_Loop>
          <Action_PacifyMinorFaction TargetEmpireVarName="$Tribe"/>

          <Action_UpdateStep StepName="SideQuestLore#0001-Step1" State="Completed" />
          <Action_UpdateQuest State="Completed"/>
        </Controller_Sequence>

        <!--Step 1 - Fail Condition 1 - Village is pacified-->
        <Controller_Sequence>
          <Decorator_VillagesPacified VillagesVarName="$InitialVillage" TargetOption="All" Initiator="AllEmpires"/>
          <Action_UpdateQuest State="Failed"/>
        </Controller_Sequence>

        <!--Step 1 - Fail Condition 2 - Village is destroyed-->
        <Controller_Sequence>
          <Decorator_VillagesDestroyed VillagesVarName="$InitialVillage" TargetOption="All" Initiator="AllEmpires"/>
          <Action_UpdateQuest State="Failed"/>
        </Controller_Sequence>

      </Controller_Parallel>

    </Controller_Sequence>

    <!--============ REWARDS ============-->
    <Steps>
      <Step Name="SideQuestLore#0001-Step1">
        <Reward Droplist="DroplistLoreQuestHeadItemReward" Picks="1"/>
        <Reward LocalizationKey="%Pacification"/>
        <ProgressionRange StartValue="0" EndValue="2"/>
      </Step>
    </Steps>

  </QuestDefinition>

  <!-- ============ The Festival of Dust / Delvers ============-->
  <QuestDefinition Name="SideQuestLore#0002" Category="SideQuest" SubCategory="Minor"
                      Cooldown="0" SkipLockedQuestTarget="true" NumberOfConcurrentInstances="8" NumberOfOccurencesPerEmpire="1" NumberOfOccurencesPerGame="0">

    <!--============ TAGS ============-->
    <Tags>BeginTurn</Tags>

    <!--Prerequisite-->
    <Prerequisites Target="$(Empire)">
      <DownloadableContentPrerequisite Flags="Prerequisite">LoreQuestsPack</DownloadableContentPrerequisite>
      <PathPrerequisite Flags="Prerequisite">../EmpireTypeMajor/AffinityDelvers</PathPrerequisite>
      <PathPrerequisite Flags="Prerequisite">../EmpireTypeMajor/ClassCity,MainCity</PathPrerequisite>
      <InterpreterPrerequisite Flags="Prerequisite">$Property(EmpireTypeMajor/ClassCity:NetCityMoney) ge 60</InterpreterPrerequisite>
    </Prerequisites>

    <!--============ VARIABLES============-->
    <Vars>

      <Var VarName="$InstigatorEmpire">
        <From Source="$Empire"/>
      </Var>

      <Var VarName="$MainCity">
        <From Source="$Empire.$Cities">
          <Where>
            <PathPrerequisite Flags="Prerequisite">ClassCity, MainCity</PathPrerequisite>
          </Where>
        </From>
      </Var>

      <InterpretedVar VarName="CurrentMainCityDustProduction" Target="$(Empire)">
        <Expression>$Property(EmpireTypeMajor/ClassCity,MainCity:NetCityMoney)</Expression>
      </InterpretedVar>

      <InterpretedVar VarName="MainCityDustProductionObjective" Target="$(Empire)">
        <Expression>$(CurrentMainCityDustProduction) + 30</Expression>
      </InterpretedVar>

      <LocalizationVar LocalizationKey="$DustProductionAmount" Source="MainCityDustProductionObjective"/>

    </Vars>

    <!--============ SEQUENCE ============-->

    <Controller_Sequence>

      <!--Step 1 - WIN-->
      <Controller_Parallel CompletionPolicy ="Any">

        <Controller_Sequence>
          <Action_UpdateStep StepName="SideQuestLore#0002-Step1" State="InProgress" />
              <Controller_Loop LoopCount="5">
                <Decorator_BeginTurn Initiator="Empire" LinkedStepProgression="SideQuestLore#0002-Step1">
                  <ConditionCheck_Prerequisite>
                    <Prerequisites Target="$Empire">
                      <InterpreterPrerequisite Flags="Prerequisite">$Property(ClassEmpire/ClassCity,MainCity:NetCityMoney) ge $(MainCityDustProductionObjective)</InterpreterPrerequisite>
                      <InterpreterPrerequisite Flags="Prerequisite">$Count(ClassEmpire/MainCity,Garrison/ClassUnit,UnitTypeDelversDwarf) ge 2</InterpreterPrerequisite>
                    </Prerequisites>
                  </ConditionCheck_Prerequisite>
                </Decorator_BeginTurn>
              </Controller_Loop>
          <Action_UpdateStep StepName="SideQuestLore#0002-Step1" State="Completed" />
          <Action_UpdateQuest State="Completed"/>
        </Controller_Sequence>

        <!--Step 1 - Fail Condition 1 - Faction no longer assimilated-->
        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite>
              <Prerequisites Target="$Empire">
                <PathPrerequisite Inverted="true" Flags="Prerequisite">../EmpireTypeMajor/AffinityDelvers</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateQuest State="Failed"/>
        </Controller_Sequence>

        <!--Step 1 - Fail Condition 2 - Main city destroyed-->
        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite>
              <Prerequisites Target="$Empire">
                <PathPrerequisite Inverted="true" Flags="Prerequisite">../EmpireTypeMajor/ClassCity,MainCity</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateQuest State="Failed"/>
        </Controller_Sequence>

      </Controller_Parallel>

    </Controller_Sequence>

    <!--============ REWARDS ============-->
    <Steps>
      <Step Name="SideQuestLore#0002-Step1">
        <Reward Droplist="DroplistLoreQuestDelverSteinReward" Picks="1"/>
        <ProgressionRange StartValue="0" EndValue="5"/>
      </Step>
    </Steps>

  </QuestDefinition>

  <!-- ============ Industrial Might / Urces ============-->
  <QuestDefinition Name="SideQuestLore#0003" Category="SideQuest" SubCategory="Minor"
                      Cooldown="10" SkipLockedQuestTarget="true" NumberOfConcurrentInstances="1" NumberOfOccurencesPerEmpire="2" NumberOfOccurencesPerGame="0">

    <!--============ TAGS ============-->
    <Tags>Talk</Tags>

    <!--Prerequisite-->
    <Prerequisites Target="$(Empire)">
      <DownloadableContentPrerequisite Flags="Prerequisite">LoreQuestsPack</DownloadableContentPrerequisite>
      <PathPrerequisite Inverted="true" Flags="Prerequisite">../EmpireTypeMajor/AffinityUrces</PathPrerequisite>
      <PathPrerequisite Flags="Prerequisite">EmpireTypeMajor/ClassResearch,TechnologyEra3</PathPrerequisite>
    </Prerequisites>

    <!--============ VARIABLES============-->
    <Vars>

      <Var VarName="$InstigatorEmpire">
        <From Source="$Empire"/>
      </Var>

      <!--Check the number of pacified villages as prerequisite-->
      <Var VarName="$InitialTribeRegion">
        <From Source="$TargetVillage.$PointOfInterest.$Position.$Region"/>
      </Var>

      <Var VarName="$StateOfMinorEmpire">
        <From Source="$InitialTribeRegion.$MinorEmpire">
          <Where>
            <InterpreterPrerequisite Flags="Prerequisite">$Count(ClassEmpire/MinorEmpireVillage,!PacifiedVillage) le 2</InterpreterPrerequisite>
            <InterpreterPrerequisite Flags="Prerequisite">$Count(ClassEmpire/MinorEmpireVillage,!ConvertedVillage) le 2</InterpreterPrerequisite>
          </Where>
        </From>
      </Var>

      <Var VarName="$InitialVillagesPointOfInterests">
        <From Source="$InitialTribeRegion.$Villages.$PointOfInterest"/>
      </Var>

      <Var VarName="$InitialVillage">
        <From Source="$TargetVillage">
          <Where>
            <PathPrerequisite Inverted="true" Flags="Prerequisite">PacifiedVillage</PathPrerequisite>
            <PathPrerequisite Inverted="true" Flags="Prerequisite">ConvertedVillage</PathPrerequisite>
          </Where>
        </From>
      </Var>

      <Var VarName="$Tribe">
        <From Source="$InitialVillage.$MinorEmpire">
          <Where>
            <PathPrerequisite Flags="Prerequisite">AffinityUrces</PathPrerequisite>
          </Where>
        </From>
      </Var>

      <Var VarName="$InitialVillagePointOfInterest">
        <From Source="$TargetPointsOfInterest"/>
      </Var>

      <!--Choose the Building-->
      <Var VarName="$EmpireCities">
        <From Source="$Empire.$Cities"/>
      </Var>

      <Var VarName="$CityImprovementToBuild">
        <Any>
          <From Source="$EmpireCities.$AvailableCityImprovements">
            <Select>Name</Select>
            <Where>
              <PathPrerequisite Inverted="true" Flags="Prerequisite">CityImprovementCoastalRetaliation</PathPrerequisite>
            </Where>
          </From>
        </Any>
      </Var>

      <Var VarName="$CityImprovementToBuildName">
        <From Source="$CityImprovementToBuild.$Name"/>
      </Var>

      <LocalizationVar LocalizationKey="$RandomImprovement" Source="$CityImprovementToBuild"/>
      <LocalizationVar LocalizationKey="$MinorFaction" Source="$Tribe"/>
      <LocalizationVar LocalizationKey="$InitialTribeRegionName" Source="$InitialTribeRegion"/>

    </Vars>

    <!--============ SEQUENCE ============-->

    <Controller_Sequence>

      <!--Step 1 - WIN-->
      <Action_UpdateStep StepName="SideQuestLore#0003-Step1" State="InProgress" />
      <Action_LockInteraction TargetVarName="$InitialVillagesPointOfInterests" InteractionName="ArmyActionParley" InteractionLockOption="Lock"/>
      <Action_LockQuestTarget TargetVarName="$InitialVillagePointOfInterest" LockOption="Lock"/>


      <Action_StartTimer Output_TimerVarName="$TimeBeforeQuestComplete"/>
      <Action_UpdateTimerLocalization TurnCountBeforeTimeOut="5" TimerLocalizationKey="$Timer" TimerVarName="$TimeBeforeQuestComplete"/>

      <Controller_Parallel CompletionPolicy="Any">

        <Controller_Sequence>
          <Decorator_ConstructionEnded ConstructionNameVarName="$CityImprovementToBuildName" Initiator="Empire"/>
          <Action_UpdateStep StepName="SideQuestLore#0003-Step1" State="Completed" />
          <Decorator_BeginTurn Initiator="Empire"/><Action_PacifyMinorFaction TargetEmpireVarName="$Tribe"/>
          <Action_UpdateQuest State="Completed"/>
        </Controller_Sequence>

        <!--Step 1 - Fail Condition 2-->
        <Controller_Sequence>
          <Decorator_TimerEnded TimerVarName="$TimeBeforeQuestComplete" TurnCountBeforeTimeOut="5" TimerLocalizationKey="$Timer" Initiator="Empire"/>
          <Action_UpdateQuest State="Failed"/>
        </Controller_Sequence>
        <!--Step 1 -Fail Condition 2-->
        <Controller_Sequence>
          <Decorator_VillagesPacified VillagesVarName="$InitialVillage" TargetOption="All" Initiator="AllEmpires"/>
          <Action_UpdateQuest State="Failed"/>
        </Controller_Sequence>
        <!--Step 1 - Fail Condition 3 - Village destroyed-->
        <Controller_Sequence>
          <Decorator_VillagesDestroyed VillagesVarName="$InitialVillage" TargetOption="All" Initiator="AllEmpires"/>
          <Action_UpdateQuest State="Failed"/>
        </Controller_Sequence>

      </Controller_Parallel>

      <Action_LockInteraction TargetVarName="$InitialVillagesPointOfInterests" InteractionName="ArmyActionParley" InteractionLockOption="Unlock"/>
      <Action_LockQuestTarget TargetVarName="$InitialVillagePointOfInterest" LockOption="Unlock"/>

    </Controller_Sequence>

    <!--============ REWARDS ============-->
    <Steps>
      <Step Name="SideQuestLore#0003-Step1">
        <Reward LocalizationKey="%Pacification"/>
        <Reward Droplist="DroplistMadFairiesMainQuestRewards" Picks="1"/>
      </Step>
    </Steps>

  </QuestDefinition>

  <!-- ============ Igor's Gift / Urces ============-->
  <QuestDefinition Name="SideQuestLore#0004" Category="SideQuest" SubCategory="Minor"
                      Cooldown="0" SkipLockedQuestTarget="true" NumberOfConcurrentInstances="8" NumberOfOccurencesPerEmpire="1" NumberOfOccurencesPerGame="0">

    <!--============ TAGS ============-->
    <Tags>BeginTurn</Tags>

    <!--Prerequisite-->
    <Prerequisites Target="$(Empire)">
      <PathPrerequisite Inverted="true" Flags="Prerequisite">EmpireTypeMajor,FactionTraitNecrophages5</PathPrerequisite>
      <PathPrerequisite Inverted="true" Flags="Prerequisite">EmpireTypeMajor,FactionTraitBrokenLords2</PathPrerequisite>
      <DownloadableContentPrerequisite Flags="Prerequisite">LoreQuestsPack</DownloadableContentPrerequisite>
      <PathPrerequisite Flags="Prerequisite">../EmpireTypeMajor/AffinityUrces</PathPrerequisite>
      <InterpreterPrerequisite Flags="Prerequisite">$Property(EmpireTypeMajor/ClassCity:NetCityGrowth) ge 50 or $Property(EmpireTypeMajor/ClassCity:Workers) ge 8</InterpreterPrerequisite>
    </Prerequisites>

    <!--============ VARIABLES============-->
    <Vars>

      <Var VarName="$InstigatorEmpire">
        <From Source="$Empire"/>
      </Var>

      <Var VarName="$AllRegions">
        <From Source="$Regions"/>
      </Var>

      <!--Set all regions but Player's regions-->
      <Var VarName="$AllRegionsButPlayerRegions">
        <From Source="$Regions">
          <Where>
            <FilterRegionIsContinent/>
            <FilterRegionByEmpire Inverted="true" EmpireVarName="$InstigatorEmpire"/>
          </Where>
        </From>
      </Var>

      <Var VarName="$AllPlayerRegions">
        <From Source="$Regions">
          <Where>
            <FilterRegionIsContinent/>
            <FilterRegionByEmpire EmpireVarName="$InstigatorEmpire"/>
          </Where>
        </From>
      </Var>

      <!--Set the city with the more DistrictFood-->
      <Var VarName="$FoodStockEmpireCity">
        <First>
          <From Source="$Empire.$Cities">
            <OrderBy>
              <SortCitiesBySimulationProperty SortBy="Descending" PropertyName="NetCityGrowth"/>
            </OrderBy>
          </From>
        </First>
      </Var>

      <!--Set the Quest POI to inspect-->
      <Var VarName="$Ruin01">
        <First>
          <From Source="$AllRegionsButPlayerRegions.$PointsOfInterest">
            <Where>
              <FilterRegionIsContinent/>
              <PathPrerequisite>QuestLocationTypeTemple</PathPrerequisite>
            </Where>
          </From>
        </First>
      </Var>
      <Var VarName="$Ruin01Region">
        <From Source="$Ruin01.$Position.$Region"/>
      </Var>
      <Var VarName="$Ruin01RegionLocation">
        <From Source="$Ruin01Region.$Position"/>
      </Var>

      <Var VarName="$Village02">
        <Any>
          <From Source="$AllPlayerRegions.$PointsOfInterest">
            <Where>
              <PathPrerequisite Flags="Prerequisite">PointOfInterestTypeVillage, VillageTypeUrces</PathPrerequisite>
            </Where>
          </From>
        </Any>
      </Var>
      <Var VarName="$Village02Location">
        <From Source="$Village02.$Position"/>
      </Var>

      <LocalizationVar LocalizationKey="$City" Source="$FoodStockEmpireCity"/>

    </Vars>

    <!--============ SEQUENCE ============-->

    <Controller_Sequence>
      <Action_LockQuestTarget TargetVarName="$Village02" LockOption="Lock"/>
      <Controller_Parallel CompletionPolicy ="Any">

        <!--Step 1: Search the Sheep in the Ruin-->
        <Controller_Sequence>
          <Action_UpdateStep StepName="SideQuestLore#0004-Step1" State="InProgress"/>
          <Action_AddQuestMarker TargetEntityVarName="$Ruin01" Tags="Ruins" RevealUnexploredLand="true" MarkerVisibleInFogOfWar="true" Output_QuestMarkerVarName="$QuestMarkerRuin01"/>
          <Action_LockQuestTarget TargetVarName="$Ruin01" LockOption="Lock"/>

          <Decorator_Inspect TargetEntityVarName="$Ruin01" Initiator="Empire"/>

          <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerRuin01"/>

          <Action_UpdateStep StepName="SideQuestLore#0004-Step1" State="Completed" />
          <Action_LockQuestTarget TargetVarName="$Ruin01" LockOption="Unlock"/>

          <!--Step 2:  Keep the Sheep in your city, even if your food decreases-->
          <Controller_Sequence>
            <Action_UpdateStep StepName="SideQuestLore#0004-Step2" State="InProgress" />
            <Controller_Loop LoopCount="5">
              <Decorator_BeginTurn Initiator="Empire" LinkedStepProgression="SideQuestLore#0004-Step2">
                <ConditionCheck_Prerequisite>
                  <Prerequisites Target="$FoodStockEmpireCity">
                    <PathPrerequisite Flags="Prerequisite">ClassCity/ClassUnit,UnitRankHero/ItemAttributesPetDustLoreQuest4</PathPrerequisite>
                  </Prerequisites>
                </ConditionCheck_Prerequisite>
              </Decorator_BeginTurn>
            </Controller_Loop>
            <Action_UpdateStep StepName="SideQuestLore#0004-Step2" State="Completed" />
          </Controller_Sequence>

          <!--Step 3: Bring it back-->
          <Action_UpdateStep StepName="SideQuestLore#0004-Step3" State="InProgress"/>
          <Action_AddQuestMarker TargetEntityVarName="$Village02" Tags="Village" RevealUnexploredLand="false" MarkerVisibleInFogOfWar="true" Output_QuestMarkerVarName="$QuestMarkerVillage02PointOfInterest"/>
          <Decorator_Talk TargetEntityVarName="$Village02" Output_InstigatorSimObjectVarName="$InspectionInstigatorSimObject" PrerequisiteNotVerifiedMessage="%QuestPrerequisiteNotVerified" Initiator="Empire">
            <ConditionCheck_Prerequisite>
              <Prerequisites Target="$InspectionInstigatorSimObject">
                <PathPrerequisite Flags="Prerequisite">ClassArmy/ClassUnit,UnitRankHero/ItemAttributesPetDustLoreQuest4</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_Talk>
          <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerVillage02PointOfInterest" />
          <Action_ForceUnlockTechnology TechnologyDefinitionName="TechnologyDefinitionItemPetDustLoreQuest4Erased"/>
          <Action_UpdateStep StepName="SideQuestLore#0004-Step3" State="Completed" />
          <Action_UpdateQuest State="Completed"/>

          <Action_SpawnArmy SpawnLocationVarName="$Village02Location" ArmyDroplist="DroplistArmyDefinitionMainQuestVaultersChapter5Step2Reward_Urces" ForbiddenSpawnLocationVarName="$ForbiddenSpawnLocation" Output_EnemyArmyGUIDVarName="$ArmyID" EmpireArmyOwnerVarName="$InstigatorEmpire"/>
        </Controller_Sequence>


        <!--Fail Condition 1: Urces are not assimiliated-->
        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite>
              <Prerequisites Target="$Empire">
                <PathPrerequisite Inverted="true" Flags="Prerequisite">../EmpireTypeMajor/AffinityUrces</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerRuin01"/>
          <Action_ForceUnlockTechnology TechnologyDefinitionName="TechnologyDefinitionItemPetDustLoreQuest4Erased"/>
          <Action_UpdateQuest State="Failed"/>
        </Controller_Sequence>

      </Controller_Parallel>
      <Action_LockQuestTarget TargetVarName="$Village02" LockOption="Unlock"/>
    </Controller_Sequence>

    <!--============ REWARDS ============-->
    <Steps>
      <Step Name="SideQuestLore#0004-Step1">
        <Reward Droplist="DroplistLoreQuestSheepItemReward" Picks="1"/>
      </Step>
      <Step Name="SideQuestLore#0004-Step2">
        <Reward Droplist="DroplistMadFairiesMainQuestRewards" Picks="1"/>
        <ProgressionRange StartValue="0" EndValue="5"/>
      </Step>
      <Step Name="SideQuestLore#0004-Step3">
        <!--Reward: 3 Urces Units-->
        <Reward LocalizationKey="%SideQuestLore#0004-Step3Reward"/>
      </Step>
    </Steps>

  </QuestDefinition>

  <!-- ============ A Diplomat in a Dang                                                erous Land / Sisters of Mercy ============-->
  <QuestDefinition Name="SideQuestLore#0005" Category="SideQuest" SubCategory="Minor"
                      Cooldown="10" SkipLockedQuestTarget="true" NumberOfConcurrentInstances="1" NumberOfOccurencesPerEmpire="2" NumberOfOccurencesPerGame="0">

    <!--============ TAGS ============-->
    <Tags>Talk</Tags>

    <!--Prerequisite-->
    <Prerequisites Target="$(Empire)">
      <DownloadableContentPrerequisite Flags="Prerequisite">LoreQuestsPack</DownloadableContentPrerequisite>
      <PathPrerequisite Inverted="true" Flags="Prerequisite">../EmpireTypeMajor/AffinitySistersOfMercy</PathPrerequisite>
      <QuestStatePrerequisite Inverted="true" QuestDefinitionName="SideQuestNavalTalk#0018" QuestState="InProgress"/>
      <QuestStatePrerequisite Inverted="true" QuestDefinitionName="SideQuestNavalTalk#0018" QuestState="Unstarted"/>
    </Prerequisites>

    <!--============ VARIABLES============-->
    <Vars>

      <Var VarName="$InstigatorEmpire">
        <From Source="$Empire"/>
      </Var>

      <!--Check the number of pacified villages as prerequisite-->
      <Var VarName="$InitialTribeRegion">
        <From Source="$TargetVillage.$PointOfInterest.$Position.$Region"/>
      </Var>

      <Var VarName="$StateOfMinorEmpire">
        <From Source="$InitialTribeRegion.$MinorEmpire">
          <Where>
            <InterpreterPrerequisite Flags="Prerequisite">$Count(ClassEmpire/MinorEmpireVillage,!PacifiedVillage) le 2</InterpreterPrerequisite>
            <InterpreterPrerequisite Flags="Prerequisite">$Count(ClassEmpire/MinorEmpireVillage,!ConvertedVillage) le 2</InterpreterPrerequisite>
          </Where>
        </From>
      </Var>
      <!--Village State-->
      <Var VarName="$InitialVillagesPointOfInterests">
        <From Source="$InitialTribeRegion.$Villages.$PointOfInterest"/>
      </Var>

      <Var VarName="$InitialVillage">
        <From Source="$TargetVillage">
          <Where>
            <PathPrerequisite Inverted="true" Flags="Prerequisite">PacifiedVillage</PathPrerequisite>
            <PathPrerequisite Inverted="true" Flags="Prerequisite">ConvertedVillage</PathPrerequisite>
          </Where>
        </From>
      </Var>
      <!--Select only the Sisters-->
      <Var VarName="$Tribe">
        <From Source="$InitialVillage.$MinorEmpire">
          <Where>
            <PathPrerequisite Flags="Prerequisite">AffinitySistersOfMercy</PathPrerequisite>
          </Where>
        </From>
      </Var>

      <Var VarName="$InitialVillagePointOfInterest">
        <From Source="$TargetPointsOfInterest"/>
      </Var>

      <LocalizationVar LocalizationKey="$MinorFaction" Source="$Tribe"/>
      <LocalizationVar LocalizationKey="$InitialTribeRegionName" Source="$InitialTribeRegion"/>

    </Vars>

    <!--============ SEQUENCE ============-->

    <Controller_Sequence>

      <Action_UpdateStep StepName="SideQuestLore#0005-Step1" State="InProgress" />
      <Action_LockQuestTarget TargetVarName="$InitialVillagePointOfInterest" LockOption="Lock"/>

      <Controller_Parallel CompletionPolicy="Any">

        <!--Step 1 - Win: Talk with 5 Diff Villages-->
        <Controller_Sequence>
          <Controller_Loop LoopCount="5">
            <Decorator_Talk LinkedStepProgression="SideQuestLore#0005-Step1" ForceDifferentTargets="true" Initiator="Empire"/>
          </Controller_Loop>

          <!-- Not Locked: it could generate other Quests, which lock the Factions-->
          <Action_UpdateStep StepName="SideQuestLore#0005-Step1" State="Completed" />
          <Action_PacifyMinorFaction TargetEmpireVarName="$Tribe"/>
          <Action_UpdateQuest State="Completed"/>
        </Controller_Sequence>

        <!--Step 1 - Fail Condition - Village is pacified-->
        <Controller_Sequence>
          <Decorator_VillagesPacified VillagesVarName="$InitialVillage" TargetOption="All" Initiator="AllEmpires"/>
          <Action_UpdateQuest State="Failed"/>
        </Controller_Sequence>

        <!--Step 1 - Fail Condition 2 - Village is destroyed-->
        <Controller_Sequence>
          <Decorator_VillagesDestroyed VillagesVarName="$InitialVillage" TargetOption="All" Initiator="AllEmpires"/>
          <Action_UpdateQuest State="Failed"/>
        </Controller_Sequence>

      </Controller_Parallel>

      <Action_LockQuestTarget TargetVarName="$InitialVillagePointOfInterest" LockOption="Unlock"/>

    </Controller_Sequence>

    <!--============ REWARDS ============-->
    <Steps>
      <Step Name="SideQuestLore#0005-Step1">
        <ProgressionRange StartValue="0" EndValue="5"/>
        <Reward LocalizationKey="%Pacification"/>
        <Reward Droplist="DroplistMadFairiesMainQuestRewards" Picks="1"/>
      </Step>
    </Steps>

  </QuestDefinition>

  <!-- ============ A Friend in Need / Sisters of Mercy ============-->
  <QuestDefinition Name="SideQuestLore#0006" Category="SideQuest" SubCategory="Minor"
                      Cooldown="0" SkipLockedQuestTarget="true" NumberOfConcurrentInstances="8" NumberOfOccurencesPerEmpire="1" NumberOfOccurencesPerGame="0">

    <!--============ TAGS ============-->
    <Tags>BeginTurn</Tags>

    <!--Prerequisite-->
    <Prerequisites Target="$(Empire)">
      <PathPrerequisite Inverted="true" Flags="Prerequisite">EmpireTypeMajor,AffinityCultists,FactionTraitCultists9</PathPrerequisite>
      <DownloadableContentPrerequisite Flags="Prerequisite">LoreQuestsPack</DownloadableContentPrerequisite>
      <PathPrerequisite Flags="Prerequisite">../EmpireTypeMajor/AffinitySistersOfMercy,!ClassUnit</PathPrerequisite>
      <PathPrerequisite Flags="Prerequisite">../EmpireTypeMajor/ClassResearch,TechnologyEra3</PathPrerequisite>
      <PathPrerequisite Inverted="true" Flags="Prerequisite">../EmpireTypeMajor/ClassResearch,TechnologyEra5</PathPrerequisite>
      <QuestStatePrerequisite Inverted="true" QuestDefinitionName="SideQuestLore#0007" QuestState="InProgress"/>
      <QuestStatePrerequisite Inverted="true" QuestDefinitionName="SideQuestLore#0007" QuestState="Unstarted"/>
    </Prerequisites>

    <!--============ SEQUENCE ============-->

    <Controller_Sequence>

      <Controller_Parallel CompletionPolicy ="Any">

        <Controller_Sequence>
          <!--Step 1-->
          <Action_UpdateStep StepName="SideQuestLore#0006-Step1" State="InProgress"/>
          <Decorator_CaptureCity Initiator="Empire" Output_CapturedCityVarName="$CapturedCity"/>
          <Action_UpdateStep StepName="SideQuestLore#0006-Step1" State="Completed" />

          <Controller_Parallel CompletionPolicy ="Any">

		    <!--Step 2-->
			<Controller_Sequence>
              <Action_UpdateStep StepName="SideQuestLore#0006-Step2" State="InProgress"/>
              <Decorator_BeginTurn Initiator="Empire">
                <ConditionCheck_Prerequisite>
                  <Prerequisites Target="$CapturedCity">
                    <InterpreterPrerequisite Flags="Prerequisite">$Count(ClassCity/RebuiltVillage) ge 1</InterpreterPrerequisite>
                  </Prerequisites>
                </ConditionCheck_Prerequisite>
              </Decorator_BeginTurn>
              <Action_UpdateStep StepName="SideQuestLore#0006-Step2" State="Completed"/>
              <Action_UpdateQuest State="Completed"/>
			</Controller_Sequence>

            <!--Fail Condition 2: In case the city is destroyed-->
            <Controller_Sequence>
                <Decorator_BeginTurn Initiator="Empire">
                  <ConditionCheck_Prerequisite Inverted="true">
                    <Prerequisites Target="$CapturedCity">
                      <PathPrerequisite Flags="Prerequisite">ClassCity</PathPrerequisite>
                    </Prerequisites>
                  </ConditionCheck_Prerequisite>
                </Decorator_BeginTurn>
              <Action_UpdateQuest State="Failed"/>
            </Controller_Sequence>

		  </Controller_Parallel>

        </Controller_Sequence>

        <!--Fail Condition 1: Sisters are not assimiliated-->
        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite>
              <Prerequisites Target="$Empire">
                <PathPrerequisite Inverted="true" Flags="Prerequisite">../EmpireTypeMajor/AffinitySistersOfMercy</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateQuest State="Failed"/>
        </Controller_Sequence>

      </Controller_Parallel>
    </Controller_Sequence>

    <!--============ REWARDS ============-->
    <Steps>
      <Step Name="SideQuestLore#0006-Step1">
        <Reward Droplist="DroplistPrestigeEra4" Picks="1"/>
      </Step>
      <Step Name="SideQuestLore#0006-Step2">
        <Reward Droplist="DroplistLoreQuestMercyBladeReward" Picks="1"/>
      </Step>
    </Steps>

  </QuestDefinition>

  <!-- ============ The Thawing of Relations / Sisters of Mercy ============-->
  <QuestDefinition Name="SideQuestLore#0007" Category="SideQuest" SubCategory="Minor"
                      Cooldown="0" SkipLockedQuestTarget="true" NumberOfConcurrentInstances="8" NumberOfOccurencesPerEmpire="1" NumberOfOccurencesPerGame="8">

    <!--============ TAGS ============-->
    <Tags>BeginTurn</Tags>

    <!--Prerequisite-->
    <Prerequisites Target="$(Empire)">
      <PathPrerequisite Inverted="true" Flags="Prerequisite">EmpireTypeMajor,FactionTraitNecrophages5</PathPrerequisite>      <!--Pitiless trait-->
      <DownloadableContentPrerequisite Flags="Prerequisite">LoreQuestsPack</DownloadableContentPrerequisite>
      <PathPrerequisite Flags="Prerequisite">../EmpireTypeMajor/AffinitySistersOfMercy</PathPrerequisite>
      <PathPrerequisite Flags="Prerequisite">EmpireTypeMajor/ClassResearch,TechnologyEra2</PathPrerequisite>
      <PathPrerequisite Inverted="true" Flags="Prerequisite">EmpireTypeMajor/ClassResearch,TechnologyEra4</PathPrerequisite>

      <PathPrerequisite Inverted="true" Flags="Prerequisite">ClassEmpire/ClassCity/UnitProfileSistersOfMercyHero1</PathPrerequisite>
      <PathPrerequisite Inverted="true" Flags="Prerequisite">ClassEmpire/ClassCity/UnitProfileSistersOfMercyHero1QuestReward</PathPrerequisite>

      <PathPrerequisite Inverted="true" Flags="Prerequisite">ClassEmpire/ClassArmy/UnitProfileSistersOfMercyHero1</PathPrerequisite>
      <PathPrerequisite Inverted="true" Flags="Prerequisite">ClassEmpire/ClassArmy/UnitProfileSistersOfMercyHero1QuestReward</PathPrerequisite>

      <PathPrerequisite Inverted="true" Flags="Prerequisite">ClassEmpire/UnitProfileSistersOfMercyHero1</PathPrerequisite>
      <PathPrerequisite Inverted="true" Flags="Prerequisite">ClassEmpire/UnitProfileSistersOfMercyHero1QuestReward</PathPrerequisite>

      <InterpreterPrerequisite Flags="Prerequisite">$(NumberOfEmpires) ge $(NumberOfPeacesAndAlliances)</InterpreterPrerequisite>

      <QuestStatePrerequisite Inverted="true" QuestDefinitionName="SideQuestLore#0006" QuestState="InProgress"/>
      <QuestStatePrerequisite Inverted="true" QuestDefinitionName="SideQuestLore#0006" QuestState="Unstarted"/>
    </Prerequisites>


    <!--============ VARIABLES============-->
    <Vars>

      <!--Peaces + Alliances-->
      <InterpretedVar VarName="NumberOfPeacesAndAlliances" Target="$(Empires)" UsedInPrerequisites="true">
        <Expression>$Property(ClassEmpire:PeaceCount) + $Property(ClassEmpire:AllianceCount) </Expression>
      </InterpretedVar>

      <!--Number of active Empires-->
      <InterpretedVar VarName="NumberOfEmpires" Target="$(Empires)" UsedInPrerequisites="true">
        <Expression>$Count(EmpireTypeMajor,!EmpireEliminated) -1</Expression>
      </InterpretedVar>

      <!--Current peace count-->
      <InterpretedVar VarName="CurrentPeaceState" Target="$(Empire)">
        <Expression>$Property(ClassEmpire:PeaceCount)</Expression>
      </InterpretedVar>

      <!--Wanted peace count-->
      <InterpretedVar VarName="ObjectivePeaceState" Target="$(Empire)">
        <Expression>$(CurrentPeaceState) + 1</Expression>
      </InterpretedVar>

      <Var VarName="$InstigatorEmpire">
        <From Source="$Empire"/>
      </Var>

      <Var VarName="$AllRegions">
        <From Source="$Regions"/>
      </Var>
      <Var VarName="$EmpireRegions">
        <From Source="$AllRegions">
          <Where>
            <FilterRegionByEmpire EmpireVarName="$InstigatorEmpire"/>
          </Where>
        </From>
      </Var>

      <Var VarName="$Village02">
        <Any>
          <From Source="$EmpireRegions.$PointsOfInterest">
            <Where>
              <PathPrerequisite Flags="Prerequisite">VillageTypeSistersOfMercy</PathPrerequisite>
            </Where>
          </From>
        </Any>
      </Var>

      <Var VarName="$Village02Location">
        <From Source="$Village02.$Position"/>
      </Var>

      <LocalizationVar LocalizationKey="$PeaceCountObjective" Source="ObjectivePeaceState"/>

    </Vars>

    <!--============ SEQUENCE ============-->

    <Controller_Sequence>
      <Controller_Parallel CompletionPolicy ="Any">

        <Controller_Sequence>
          <Controller_Parallel CompletionPolicy ="All">

            <Controller_Sequence>
              <Controller_Parallel CompletionPolicy ="Any">

                <!--Step 1: be at peace with +1 Empire-->
                <Controller_Sequence>
                  <Action_UpdateStep StepName="SideQuestLore#0007-Step1" State="InProgress" />
                  <Decorator_BeginTurn Initiator="Empire" >
                    <InterpretedVarsToUpdate>
                      <Var>CurrentPeaceState</Var>
                    </InterpretedVarsToUpdate>
                    <ConditionCheck_IsStepProgressionComplete InterpretedValue="$(CurrentPeaceState)" StepName="SideQuestLore#0007-Step1" />
                  </Decorator_BeginTurn>
                  <Action_SpawnArmy SpawnLocationVarName="$Village02Location" ArmyDroplist="DroplistLoreQuest0007UnitsReward" ForbiddenSpawnLocationVarName="$ForbiddenSpawnLocation" EmpireArmyOwnerVarName="$InstigatorEmpire"/>
                  <Action_UpdateStep StepName="SideQuestLore#0007-Step1" State="Completed" />
                </Controller_Sequence>

                <!--Step 1 Alt: be at peace with all Empires-->
                <Controller_Sequence>
                  <Action_UpdateStep StepName="SideQuestLore#0007-Step1" State="InProgress" />
                  <Decorator_BeginTurn Target="$(Empires)">
                    <InterpretedVarsToUpdate>
                      <Var>NumberOfEmpires</Var>
                    </InterpretedVarsToUpdate>
                    <ConditionCheck_Prerequisite>
                      <Prerequisites Target="$Empire">
                        <InterpreterPrerequisite Flags="Prerequisite">$(CurrentPeaceState) ge $(NumberOfEmpires)</InterpreterPrerequisite>
                        <InterpreterPrerequisite Flags="Prerequisite">$(NumberOfEmpires) gt 0</InterpreterPrerequisite>
                      </Prerequisites>
                    </ConditionCheck_Prerequisite>
                  </Decorator_BeginTurn>
                  <Action_SpawnArmy SpawnLocationVarName="$Village02Location" ArmyDroplist="DroplistLoreQuest0007UnitsReward" ForbiddenSpawnLocationVarName="$ForbiddenSpawnLocation" EmpireArmyOwnerVarName="$InstigatorEmpire"/>
                  <Action_UpdateStep StepName="SideQuestLore#0007-Step1" State="Completed" />
                </Controller_Sequence>

              </Controller_Parallel>

              <!--Step2-->
              <Controller_Parallel CompletionPolicy ="Any">

                  <Controller_Sequence>
                    <Action_UpdateStep StepName="SideQuestLore#0007-Step2" State="InProgress" />
                    <Controller_Loop LoopCount="5">
                      <Decorator_BeginTurn Initiator="Empire" LinkedStepProgression="SideQuestLore#0007-Step2">
                        <InterpretedVarsToUpdate>
                          <Var>CurrentPeaceState</Var>
                        </InterpretedVarsToUpdate>
                        <ConditionCheck_Prerequisite>
                          <Prerequisites Target="$Empire">
                            <InterpreterPrerequisite Flags="Prerequisite">$(CurrentPeaceState) ge $(ObjectivePeaceState)</InterpreterPrerequisite>
                          </Prerequisites>
                        </ConditionCheck_Prerequisite>
                      </Decorator_BeginTurn>
                    </Controller_Loop>
                    <Action_UpdateStep StepName="SideQuestLore#0007-Step2" State="Completed" />
                    <Action_UpdateQuest State="Completed" />
                  </Controller_Sequence>

                  <!--Fail Condition 1: Peace count -1-->
                  <Controller_Sequence>
                    <Decorator_BeginTurn Initiator="Empire">
                      <InterpretedVarsToUpdate>
                        <Var>CurrentPeaceState</Var>
                      </InterpretedVarsToUpdate>
                      <ConditionCheck_Prerequisite>
                        <Prerequisites Target="$Empire">
                          <InterpreterPrerequisite Flags="Prerequisite">$(CurrentPeaceState) lt $(ObjectivePeaceState)</InterpreterPrerequisite>
                        </Prerequisites>
                      </ConditionCheck_Prerequisite>
                    </Decorator_BeginTurn>
                    <Action_UpdateQuest State="Failed"/>
                  </Controller_Sequence>

                </Controller_Parallel>
            </Controller_Sequence>

          </Controller_Parallel>
        </Controller_Sequence>

        <!--Fail Condition 2: SistersOfMercy are not assimilated-->
        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite>
              <Prerequisites Target="$Empire">
                <PathPrerequisite Inverted="true" Flags="Prerequisite">../EmpireTypeMajor/AffinitySistersOfMercy</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateQuest State="Failed"/>
        </Controller_Sequence>

      </Controller_Parallel>
    </Controller_Sequence>

    <!--============ REWARDS ============-->
    <Steps>
      <Step Name="SideQuestLore#0007-Step1">
        <ProgressionRange StartValue="0" EndValueVarName="ObjectivePeaceState"/>
        <!--Reward: 3 Sisters Of Mercy-->
        <Reward LocalizationKey="%SideQuestLore#0007-Step1Reward"/>
      </Step>
      <!--Reward: Sister's Hero-->
      <Step Name="SideQuestLore#0007-Step2">
        <ProgressionRange StartValue="0" EndValue="5"/>
        <Reward Droplist="DroplistLoreQuest0007HeroReward"/>
      </Step>
    </Steps>

  </QuestDefinition>

  <!-- ============ Crystalline Caverns / Silics ============-->
  <QuestDefinition Name="SideQuestLore#0008" Category="SideQuest" SubCategory="Minor"
                      Cooldown="20" SkipLockedQuestTarget="true" NumberOfConcurrentInstances="1" NumberOfOccurencesPerEmpire="2" NumberOfOccurencesPerGame="0">

    <!--============ TAGS ============-->
    <Tags>Talk</Tags>

    <!--Prerequisite-->
    <Prerequisites Target="$(Empire)">
      <DownloadableContentPrerequisite Flags="Prerequisite">LoreQuestsPack</DownloadableContentPrerequisite>
      <PathPrerequisite Inverted="true" Flags="Prerequisite">../EmpireTypeMajor/AffinitySilics</PathPrerequisite>
      <PathPrerequisite Inverted="true" Flags="Prerequisite">../EmpireTypeMajor,AffinityCultists</PathPrerequisite>
      <PathPrerequisite Inverted="true" Flags="Prerequisite">../EmpireTypeMajor,AffinityMimics</PathPrerequisite>
      <InterpreterPrerequisite Flags="Prerequisite">$Property(ClassEmpire:CurrentTurn) ge (10 * $Property(ClassEmpire:GameSpeedMultiplier))</InterpreterPrerequisite>
      <!--Avoid the 0 Turn resolution-->
      <InterpreterPrerequisite Flags="Prerequisite">$Count(EmpireTypeMajor/ClassCity/ExploitedPointOfInterest, PointOfInterestTypeResourceDeposit, ResourceTypeStrategic) ge 1</InterpreterPrerequisite>
      <!--At least 1 extractor built-->
      <InterpreterPrerequisite Flags="Prerequisite">$Count(EmpireTypeMajor/ClassCity/PointOfInterestTypeResourceDeposit, ResourceTypeStrategic) ge 2</InterpreterPrerequisite>
      <!--At least 2 free deposits/extractors not built-->
    </Prerequisites>

    <!--============ VARIABLES============-->
    <Vars>

      <Var VarName="$InstigatorEmpire">
        <From Source="$Empire"/>
      </Var>

      <!--Check the number of pacified villages as prerequisite-->
      <Var VarName="$InitialTribeRegion">
        <From Source="$TargetVillage.$PointOfInterest.$Position.$Region"/>
      </Var>

      <Var VarName="$StateOfMinorEmpire">
        <From Source="$InitialTribeRegion.$MinorEmpire">
          <Where>
            <InterpreterPrerequisite Flags="Prerequisite">$Count(ClassEmpire/MinorEmpireVillage,!PacifiedVillage) ge 2</InterpreterPrerequisite>
            <InterpreterPrerequisite Flags="Prerequisite">$Count(ClassEmpire/MinorEmpireVillage,!ConvertedVillage) ge 2</InterpreterPrerequisite>
          </Where>
        </From>
      </Var>

      <!--Villages States-->
      <Var VarName="$InitialVillagesPointOfInterests">
        <From Source="$InitialTribeRegion.$Villages.$PointOfInterest"/>
      </Var>

      <Var VarName="$InitialVillage">
        <From Source="$TargetVillage">
          <Where>
            <PathPrerequisite Inverted="true" Flags="Prerequisite">PacifiedVillage</PathPrerequisite>
            <PathPrerequisite Inverted="true" Flags="Prerequisite">ConvertedVillage</PathPrerequisite>
          </Where>
        </From>
      </Var>

      <!--Select only the Silics-->
      <Var VarName="$Tribe">
        <From Source="$InitialVillage.$MinorEmpire">
          <Where>
            <PathPrerequisite Flags="Prerequisite">AffinitySilics</PathPrerequisite>
          </Where>
        </From>
      </Var>

      <Var VarName="$InitialVillagePointOfInterest">
        <From Source="$TargetPointsOfInterest"/>
      </Var>
      <Var VarName="$InitialVillagePosition">
        <From Source="$InitialVillagePointOfInterest.$Position"/>
      </Var>

      <!--Current extractors built-->
      <InterpretedVar VarName="CurrentExtractorsBuilt" Target="$(Empire)">
        <Expression>$Count(EmpireTypeMajor/ClassCity/ExploitedPointOfInterest, PointOfInterestTypeResourceDeposit, ResourceTypeStrategic)</Expression>
      </InterpretedVar>

      <!--Objective at peace count-->
      <InterpretedVar VarName="ObjectiveExtractorsBuilt" Target="$(Empire)">
        <Expression>$(CurrentExtractorsBuilt) + 2</Expression>
      </InterpretedVar>

      <LocalizationVar LocalizationKey="$ExtractorsToBuilt" Source="ObjectiveExtractorsBuilt"/>
      <LocalizationVar LocalizationKey="$MinorFaction" Source="$Tribe"/>
      <LocalizationVar LocalizationKey="$InitialTribeRegionName" Source="$InitialTribeRegion"/>

    </Vars>

    <!--============ SEQUENCE ============-->

    <Controller_Sequence>

      <Action_LockQuestTarget TargetVarName="$InitialVillagePointOfInterest" LockOption="Lock"/>

      <!--Step 1 - WIN-->
      <Controller_Parallel CompletionPolicy="Any">

        <!--Step 1-->
        <Controller_Sequence>
          <Action_UpdateStep StepName="SideQuestLore#0008-Step1" State="InProgress" />
          <Decorator_BeginTurn Initiator="Empire">
            <InterpretedVarsToUpdate>
              <Var>CurrentExtractorsBuilt</Var>
            </InterpretedVarsToUpdate>
            <ConditionCheck_Prerequisite>
              <Prerequisites Target="$Empire">
                <InterpreterPrerequisite Flags="Prerequisite">$(CurrentExtractorsBuilt) ge $(ObjectiveExtractorsBuilt)</InterpreterPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_PacifyMinorFaction TargetEmpireVarName="$Tribe"/>
          <Action_UpdateStep StepName="SideQuestLore#0008-Step1" State="Completed" />
          <Action_UpdateQuest State="Completed"/>
        </Controller_Sequence>

        <!--Step 1 - Fail Condition 1 - Village is pacified-->
        <Controller_Sequence>
          <Decorator_VillagesPacified VillagesVarName="$InitialVillage" TargetOption="All" Initiator="AllEmpires"/>
          <Action_UpdateQuest State="Failed"/>
        </Controller_Sequence>

        <!--Step 1 - Fail Condition 2 - Village is destroyed-->
        <Controller_Sequence>
          <Decorator_VillagesDestroyed VillagesVarName="$InitialVillage" TargetOption="All" Initiator="AllEmpires"/>
          <Action_UpdateQuest State="Failed"/>
        </Controller_Sequence>

      </Controller_Parallel>

      <Action_LockQuestTarget TargetVarName="$InitialVillagePointOfInterest" LockOption="Unlock"/>

    </Controller_Sequence>

    <!--============ REWARDS ============-->
    <Steps>
      <Step Name="SideQuestLore#0008-Step1">
        <Reward Droplist="DroplistLoreQuest0008-Step1" Picks="1"/>
        <Reward LocalizationKey="%Pacification"/>
      </Step>
    </Steps>

  </QuestDefinition>

  <!-- ============ The Lost Explorers / Silics ============-->
  <QuestDefinition Name="SideQuestLore#0009" Category="SideQuest" SubCategory="Minor"
                     Cooldown="0" SkipLockedQuestTarget="true" NumberOfConcurrentInstances="8" NumberOfOccurencesPerEmpire="1" NumberOfOccurencesPerGame="0">

    <!--============ TAGS ============-->
    <Tags>BeginTurn</Tags>

    <!--============ PREREQUISITES ============-->
    <Prerequisites Target="$(Empire)">
      <DownloadableContentPrerequisite Flags="Prerequisite">LoreQuestsPack</DownloadableContentPrerequisite>
      <PathPrerequisite Flags="Prerequisite">../EmpireTypeMajor/AffinitySilics</PathPrerequisite>
      <PathPrerequisite Inverted="true" Flags="Prerequisite">../EmpireTypeMajor/AffinityHaunts</PathPrerequisite>
      <InterpreterPrerequisite Flags="Prerequisite">$Count(EmpireTypeMajor/ClassCity/ExploitedPointOfInterest, PointOfInterestTypeResourceDeposit, ResourceTypeStrategic) ge 4</InterpreterPrerequisite>
    </Prerequisites>


    <!--============ VARIABLES============-->
    <Vars>

      <!--Set Player's empire-->
      <Var VarName="$InstigatorEmpire">
        <From Source="$Empire"/>
      </Var>

      <!--Set the player main city-->
      <Var VarName="$EmpireCity">
        <Any>
          <From Source="$Empire.$Cities">
          </From>
        </Any>
      </Var>

      <Var VarName="$EmpireCityRegion">
        <From Source="$EmpireCity.$Region"/>
      </Var>

      <Var VarName="$SurroundingRegions">
        <From Source="$EmpireCityRegion.$RegionWithNeighbourRegions">
          <Where>
            <FilterRegionIsOnSameContinent RegionContextVarName="$EmpireCityRegion"/>
            <FilterRegionByEmpire Inverted="true" EmpireVarName="$InstigatorEmpire"/>
          </Where>
        </From>
      </Var>

      <Var VarName="$QuestPOI">
        <Last>
          <From Source="$SurroundingRegions.$PointsOfInterest">
            <Where>
              <PathPrerequisite>PointOfInterestTypeQuestLocation</PathPrerequisite>
            </Where>
          </From>
        </Last>
      </Var>

      <!--POI to spawn-->
      <Var VarName="$QuestPOIToSpawn">
        <!--Set the Quest POI in the lastly selected region for army to spawn-->
        <First>
          <From Source="$SurroundingRegions.$PointsOfInterest">
            <Where>
              <PathPrerequisite>PointOfInterestTypeQuestLocation</PathPrerequisite>
            </Where>
          </From>
        </First>
      </Var>

      <Var VarName="$QuestPOIToSpawnPosition">
        <!--Set the Quest POI position to spawn-->
        <From Source="$QuestPOI.$Position"/>
      </Var>

    </Vars>

    <!--============ SEQUENCE ============-->
    <Controller_Sequence>

      <Controller_Parallel CompletionPolicy="Any">

        <Controller_Sequence>
          <!--Step 1-->
          <Action_UpdateStep StepName="SideQuestLore#0009-Step1" State="InProgress" />
          <Action_AddQuestMarker TargetEntityVarName="$QuestPOI" Tags="Ruins" RevealUnexploredLand="true" MarkerVisibleInFogOfWar="true" Output_QuestMarkerVarName="$QuestMarkerQuestPOIPosition1"/>
          <Decorator_Inspect TargetEntityVarName="$QuestPOI" Output_InstigatorSimObjectVarName="$InspectionInstigatorSimObject" PrerequisiteNotVerifiedMessage="%QuestPrerequisiteNotVerified" Initiator="Empire">
            <ConditionCheck_Prerequisite>
              <Prerequisites Target="$InspectionInstigatorSimObject">
                <InterpreterPrerequisite Flags="Prerequisite">$Count(ClassArmy/ClassUnit,UnitTypeSilicsGolem) ge 2</InterpreterPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_Inspect>
          <Action_UpdateStep StepName="SideQuestLore#0009-Step1" State="Completed"/>

          <!--Step 2-->
          <Action_UpdateStep StepName="SideQuestLore#0009-Step2" State="InProgress" />
          <Action_StartTimer Output_TimerVarName="$Timer"/>
          <Action_UpdateTimerLocalization TurnCountBeforeTimeOut="10" TimerLocalizationKey="$Timer" TimerVarName="$Timer"/>

		  <Controller_Parallel CompletionPolicy="Any">

              <!--1st Spawn-->
            <Controller_Sequence>

              <!--1st Spawn-->
              <Decorator_TimerEnded TimerVarName="$Timer" TurnCountBeforeTimeOut="1" Initiator="Empire"/>
              <Action_SpawnArmy SpawnLocationVarName="$QuestPOIToSpawnPosition" ArmyDroplist="DroplistLoreQuest0009-Step2" Output_EnemyArmyGUIDVarName="$ArmyID1"/>
              <Action_UpdateArmyObjective ArmyGUIDVarName="$ArmyID1" TargetEmpireVarName="$InstigatorEmpire" BehaviourName="Offense"/>
              <Decorator_KillArmy TargetOption="All" Initiator="AllEmpires">
                <EnemyArmyGUIDVarName>$ArmyID1</EnemyArmyGUIDVarName>
              </Decorator_KillArmy>

              <!--2st Spawn-->
              <Decorator_TimerEnded TimerVarName="$Timer" TurnCountBeforeTimeOut="3" Initiator="Empire"/>
              <Action_SpawnArmy SpawnLocationVarName="$QuestPOIToSpawnPosition" ArmyDroplist="DroplistLoreQuest0009-Step2" Output_EnemyArmyGUIDVarName="$ArmyID2"/>
              <Action_UpdateArmyObjective ArmyGUIDVarName="$ArmyID2" TargetEmpireVarName="$InstigatorEmpire" BehaviourName="Offense"/>
              <Decorator_KillArmy TargetOption="All" Initiator="AllEmpires">
                <EnemyArmyGUIDVarName>$ArmyID2</EnemyArmyGUIDVarName>
              </Decorator_KillArmy>

              <!--3st Spawn-->
              <Decorator_TimerEnded TimerVarName="$Timer" TurnCountBeforeTimeOut="5" Initiator="Empire"/>
              <Action_SpawnArmy SpawnLocationVarName="$QuestPOIToSpawnPosition" ArmyDroplist="DroplistLoreQuest0009-Step2" Output_EnemyArmyGUIDVarName="$ArmyID3"/>
              <Action_UpdateArmyObjective ArmyGUIDVarName="$ArmyID3" TargetEmpireVarName="$InstigatorEmpire" BehaviourName="Offense"/>
              <Decorator_KillArmy TargetOption="All" Initiator="AllEmpires">
                <EnemyArmyGUIDVarName>$ArmyID3</EnemyArmyGUIDVarName>
              </Decorator_KillArmy>

              <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerQuestPOIPosition1" />
              <Action_UpdateStep StepName="SideQuestLore#0009-Step2" State="Completed"/>
              <Action_UpdateQuest State="Completed"/>

            </Controller_Sequence>

            <Controller_Sequence>
              <Decorator_TimerEnded TimerVarName="$Timer" TurnCountBeforeTimeOut="10" TimerLocalizationKey="$Timer" Initiator="Empire"/>
			  <Action_DestroyArmy ArmyGUIDVarName="$ArmyID1" />
              <Action_DestroyArmy ArmyGUIDVarName="$ArmyID2" />
              <Action_DestroyArmy ArmyGUIDVarName="$ArmyID3" />
			  <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerQuestPOIPosition1" />
			  <Action_UpdateQuest State="Failed"/>
            </Controller_Sequence>

          </Controller_Parallel>

        </Controller_Sequence>

        <!--Fail condition - Silics no more assimilated-->
        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite>
              <Prerequisites Target="$Empire">
                <PathPrerequisite Inverted="true" Flags="Prerequisite">../EmpireTypeMajor/AffinitySilics</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
		  <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerQuestPOIPosition1" />
          <Action_UpdateQuest State="Failed"/>
        </Controller_Sequence>

      </Controller_Parallel>
    </Controller_Sequence>

    <!--============ REWARDS ============-->
    <Steps>
      <Step Name="SideQuestLore#0009-Step1">
        <Reward Droplist="DroplistResources" Picks="1"/>
      </Step>
      <Step Name="SideQuestLore#0009-Step2">
        <Reward Droplist="DroplistLoreQuestDisharmonyShieldReward" Picks="1"/>
      </Step>
    </Steps>

  </QuestDefinition>

  <!-- ============ Ancient Enmities / Dorgeshi ============-->
  <QuestDefinition Name="SideQuestLore#0010" Category="SideQuest" SubCategory="Minor"
                      Cooldown="1" SkipLockedQuestTarget="true" NumberOfConcurrentInstances="1" NumberOfOccurencesPerEmpire="1" NumberOfOccurencesPerGame="0">

    <!--============ TAGS ============-->
    <Tags>Talk</Tags>

    <!--Prerequisite-->
    <Prerequisites Target="$(Empire)">
      <DownloadableContentPrerequisite Flags="Prerequisite">LoreQuestsPack</DownloadableContentPrerequisite>
      <PathPrerequisite Flags="Prerequisite">../EmpireTypeMajor,AffinityRovingClans</PathPrerequisite>
      <PathPrerequisite Inverted="true" Flags="Prerequisite">../EmpireTypeMajor,AffinityDorgeshi</PathPrerequisite>
      <PathPrerequisite Inverted="true" Flags="Prerequisite">EmpireTypeMajor,FactionTraitReplicants1</PathPrerequisite>
    </Prerequisites>

    <!--============ VARIABLES============-->
    <Vars>

      <!--Ask to produce more Science in the City that is producing the more Science-->
      <InterpretedVar VarName="CurrentMaxScienceProduction" Target="$(Empire)">
        <Expression>$MaxProperty(EmpireTypeMajor/ClassCity:NetCityResearch)</Expression>
      </InterpretedVar>

      <InterpretedVar VarName="MaxScienceProductionObjective" Target="$(Empire)">
        <Expression>$(CurrentMaxScienceProduction) + 30</Expression>
      </InterpretedVar>

      <!--Check the number of pacified villages as prerequisite-->
      <Var VarName="$InitialTribeRegion">
        <From Source="$TargetVillage.$PointOfInterest.$Position.$Region"/>
      </Var>

      <Var VarName="$StateOfMinorEmpire">
        <From Source="$InitialTribeRegion.$MinorEmpire">
          <Where>
            <InterpreterPrerequisite Flags="Prerequisite">$Count(ClassEmpire/MinorEmpireVillage,!PacifiedVillage) le 2</InterpreterPrerequisite>
            <InterpreterPrerequisite Flags="Prerequisite">$Count(ClassEmpire/MinorEmpireVillage,!ConvertedVillage) le 2</InterpreterPrerequisite>
          </Where>
        </From>
      </Var>

      <!--Villages States-->
      <Var VarName="$InitialVillagesPointOfInterests">
        <From Source="$InitialTribeRegion.$Villages.$PointOfInterest"/>
      </Var>

      <Var VarName="$InitialVillage">
        <From Source="$TargetVillage">
          <Where>
            <PathPrerequisite Inverted="true" Flags="Prerequisite">PacifiedVillage</PathPrerequisite>
            <PathPrerequisite Inverted="true" Flags="Prerequisite">ConvertedVillage</PathPrerequisite>
          </Where>
        </From>
      </Var>

      <!--Select only the Dorgeshi-->
      <Var VarName="$Tribe">
        <From Source="$InitialVillage.$MinorEmpire">
          <Where>
            <PathPrerequisite Flags="Prerequisite">AffinityDorgeshi</PathPrerequisite>
          </Where>
        </From>
      </Var>

      <Var VarName="$InitialVillagePointOfInterest">
        <From Source="$TargetPointsOfInterest"/>
      </Var>

      <!--Check which city has the more Science production-->
      <Var VarName="$ScienceProductionEmpireCity">
        <First>
          <From Source="$Empire.$Cities">
            <OrderBy>
              <SortCitiesBySimulationProperty SortBy="Descending" PropertyName="CityResearch"/>
            </OrderBy>
          </From>
        </First>
      </Var>

      <!--Set Dust to give to 1st village-->
      <DropListVar VarName="$DustAmount" DropList="DroplistStrategicDustAmount"/>
      <DropListVar VarName="$DustTransfertAmount" DropList="DroplistStrategicDustTransfertAmount"/>
      <DropListVar VarName="$DustResource" DropList="DroplistMainQuestBrokenLordsChapter1ResourceName"/>

      <LocalizationVar LocalizationKey="$ScienceProductionAmount" Source="MaxScienceProductionObjective"/>
      <LocalizationVar LocalizationKey="$DustAmount" Source="$DustAmount"/>
      <LocalizationVar LocalizationKey="$City" Source="$ScienceProductionEmpireCity"/>
      <LocalizationVar LocalizationKey="$MinorFaction" Source="$Tribe"/>
      <LocalizationVar LocalizationKey="$InitialTribeRegionName" Source="$InitialTribeRegion"/>

    </Vars>

    <!--============ SEQUENCE ============-->

    <Controller_Sequence>
      <Action_UpdateStep StepName="SideQuestLore#0010-Step1" State="InProgress" />
      <Action_LockQuestTarget TargetVarName="$InitialVillagePointOfInterest" LockOption="Lock"/>

      <Controller_Parallel CompletionPolicy="Any">

      <Controller_Sequence>
      <!--Step 1 - WIN-->
      <Controller_Parallel CompletionPolicy="Any">

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite>
              <Prerequisites Target="$ScienceProductionEmpireCity">
                <InterpreterPrerequisite Flags="Prerequisite">$Property(ClassCity:NetCityResearch) ge $(MaxScienceProductionObjective)</InterpreterPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0010-Step1" State="Completed" />
        </Controller_Sequence>

        <!--Step 1 - Fail Condition 3 - City is destroyed-->
        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite Inverted="true">
              <Prerequisites Target="$ScienceProductionEmpireCity">
                <PathPrerequisite Flags="Prerequisite">ClassCity</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateQuest State="Failed"/>
          <Action_UpdateStep StepName="SideQuestLore#0010-Step2" State="Failed"/>
        </Controller_Sequence>

      </Controller_Parallel>

      <!--Step2 - WIN -->
      <Action_UpdateStep StepName="SideQuestLore#0010-Step2" State="InProgress"/>
      <Controller_Parallel CompletionPolicy="Any">

        <Controller_Sequence>
          <Action_StartTimer Output_TimerVarName="$TimeBeforeQuestComplete"/>
          <Action_UpdateTimerLocalization TurnCountBeforeTimeOut="6" TimerLocalizationKey="$Timer" TimerVarName="$TimeBeforeQuestComplete"/>
          <Action_AddQuestMarker TargetEntityVarName="$InitialVillagePointOfInterest" Tags="Village" RevealUnexploredLand="false" MarkerVisibleInFogOfWar="false" Output_QuestMarkerVarName="$QuestMarkerInitialVillagePointOfInterest"/>

          <Decorator_Talk TargetEntityVarName="$InitialVillagePointOfInterest" PrerequisiteNotVerifiedMessage="%QuestPrerequisiteNotVerified">
            <ConditionCheck_HasResourceAmount ResourceNameVarName="$DustResource" WantedAmountVarName="$DustAmount"/>
          </Decorator_Talk>
          <Action_TransferResource ResourceNameVarName="$DustResource" AmountVarName="$DustTransfertAmount"/>
          <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerInitialVillagePointOfInterest"/>
          <Action_PacifyMinorFaction TargetEmpireVarName="$Tribe"/>
          <Action_UpdateStep StepName="SideQuestLore#0010-Step2" State="Completed"/>
          <Action_UpdateQuest State="Completed"/>
        </Controller_Sequence>

        <!--Step 2 - Fail Condition 1 - Timer ended-->
        <Controller_Sequence>
          <Decorator_TimerEnded TimerVarName="$TimeBeforeQuestComplete" TurnCountBeforeTimeOut="6" TimerLocalizationKey="$Timer" Initiator="Empire"/>
          <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerInitialVillagePointOfInterest"/>
          <Action_UpdateQuest State="Failed"/>
        </Controller_Sequence>

      </Controller_Parallel>

      <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerInitialVillagePointOfInterest"/>
      <Action_LockQuestTarget TargetVarName="$InitialVillagePointOfInterest" LockOption="Unlock"/>
    </Controller_Sequence>

      <!--Fail Condition 2 - Village is pacified-->
      <Controller_Sequence>
      <Decorator_VillagesPacified VillagesVarName="$InitialVillage" TargetOption="All" Initiator="AllEmpires"/>
      <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerInitialVillagePointOfInterest"/>
      <Action_LockQuestTarget TargetVarName="$InitialVillagePointOfInterest" LockOption="Unlock"/>
      <Action_UpdateQuest State="Failed"/>
      <Action_UpdateStep StepName="SideQuestLore#0010-Step2" State="Failed"/>
    </Controller_Sequence>

      <!--Fail Condition 3 - Village is destroyed-->
      <Controller_Sequence>
        <Decorator_VillagesDestroyed VillagesVarName="$InitialVillage" TargetOption="All" Initiator="AllEmpires"/>
        <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerInitialVillagePointOfInterest"/>
        <Action_LockQuestTarget TargetVarName="$InitialVillagePointOfInterest" LockOption="Unlock"/>
        <Action_UpdateQuest State="Failed"/>
        <Action_UpdateStep StepName="SideQuestLore#0010-Step2" State="Failed"/>
      </Controller_Sequence>

      </Controller_Parallel>
    </Controller_Sequence>

    <!--============ REWARDS ============-->
    <Steps>
      <Step Name="SideQuestLore#0010-Step1">
        <Reward Droplist="DroplistLoreQuestDorgeshiSpearReward" Picks="1"/>
      </Step>
      <Step Name="SideQuestLore#0010-Step2">
        <Reward LocalizationKey="%Pacification"/>
      </Step>
    </Steps>

  </QuestDefinition>

  <!-- ============ A Fragile Peace - Alternative Version / Dorgeshi ============-->
  <QuestDefinition Name="SideQuestLore#0010Alt" Category="SideQuest" SubCategory="Minor"
                      Cooldown="1" SkipLockedQuestTarget="true" NumberOfConcurrentInstances="1" NumberOfOccurencesPerEmpire="1" NumberOfOccurencesPerGame="0">

    <!--============ TAGS ============-->
    <Tags>Talk</Tags>

    <!--Prerequisite-->
    <Prerequisites Target="$(Empire)">
      <DownloadableContentPrerequisite Flags="Prerequisite">LoreQuestsPack</DownloadableContentPrerequisite>
      <PathPrerequisite Inverted="true" Flags="Prerequisite">../EmpireTypeMajor,AffinityRovingClans</PathPrerequisite>
      <PathPrerequisite Inverted="true" Flags="Prerequisite">../EmpireTypeMajor,AffinityDorgeshi</PathPrerequisite>
    </Prerequisites>

    <!--============ VARIABLES============-->
    <Vars>

      <Var VarName="$InstigatorEmpire">
        <From Source="$Empire"/>
      </Var>

      <Var VarName="$MainCity">
        <From Source="$Empire.$Cities">
          <Where>
            <PathPrerequisite Flags="Prerequisite">ClassCity, MainCity</PathPrerequisite>
          </Where>
        </From>
      </Var>

      <!--Check the number of pacified villages as prerequisite-->
      <Var VarName="$InitialTribeRegion">
        <From Source="$TargetVillage.$PointOfInterest.$Position.$Region"/>
      </Var>

      <Var VarName="$StateOfMinorEmpire">
        <From Source="$InitialTribeRegion.$MinorEmpire">
          <Where>
            <InterpreterPrerequisite Flags="Prerequisite">$Count(ClassEmpire/MinorEmpireVillage,!PacifiedVillage) le 2</InterpreterPrerequisite>
            <InterpreterPrerequisite Flags="Prerequisite">$Count(ClassEmpire/MinorEmpireVillage,!ConvertedVillage) le 2</InterpreterPrerequisite>
          </Where>
        </From>
      </Var>
      <!--Villages States-->
      <Var VarName="$InitialVillagesPointOfInterests">
        <From Source="$InitialTribeRegion.$Villages.$PointOfInterest"/>
      </Var>

      <Var VarName="$InitialVillage">
        <From Source="$TargetVillage">
          <Where>
            <PathPrerequisite Inverted="true" Flags="Prerequisite">PacifiedVillage</PathPrerequisite>
            <PathPrerequisite Inverted="true" Flags="Prerequisite">ConvertedVillage</PathPrerequisite>
          </Where>
        </From>
      </Var>
      <!--Select only the Dorgeshi-->
      <Var VarName="$Tribe">
        <From Source="$InitialVillage.$MinorEmpire">
          <Where>
            <PathPrerequisite Flags="Prerequisite">AffinityDorgeshi</PathPrerequisite>
          </Where>
        </From>
      </Var>

      <Var VarName="$InitialVillagePointOfInterest">
        <From Source="$TargetPointsOfInterest"/>
      </Var>

      <!--Check which city has the more Dust production-->
      <Var VarName="$DustProductionEmpireCity">
        <First>
          <From Source="$Empire.$Cities">
            <OrderBy>
              <SortCitiesBySimulationProperty SortBy="Descending" PropertyName="NetCityMoney"/>
            </OrderBy>
          </From>
        </First>
      </Var>

      <!--Ask to produce more Dust in the City that is producing the more Dust-->
      <InterpretedVar VarName="CurrentMaxDustProduction" Target="$(Empire)">
        <Expression>$MaxProperty(EmpireTypeMajor/ClassCity:NetCityMoney)</Expression>
      </InterpretedVar>

      <InterpretedVar VarName="MaxDustProductionObjective" Target="$(Empire)">
        <Expression>$(CurrentMaxDustProduction) + 30</Expression>
      </InterpretedVar>

      <!--Set Dust to give to 1st village-->
      <DropListVar VarName="$DustAmount" DropList="DroplistStrategicDustAmount"/>
      <DropListVar VarName="$DustTransfertAmount" DropList="DroplistStrategicDustTransfertAmount"/>
      <DropListVar VarName="$DustResource" DropList="DroplistMainQuestBrokenLordsChapter1ResourceName"/>

      <LocalizationVar LocalizationKey="$DustAmount" Source="$DustAmount"/>
      <LocalizationVar LocalizationKey="$DustProductionAmount" Source="MaxDustProductionObjective"/>
      <LocalizationVar LocalizationKey="$City" Source="$DustProductionEmpireCity"/>
      <LocalizationVar LocalizationKey="$MinorFaction" Source="$Tribe"/>
      <LocalizationVar LocalizationKey="$InitialTribeRegionName" Source="$InitialTribeRegion"/>

    </Vars>

    <!--============ SEQUENCE ============-->

    <Controller_Sequence>
      <Action_UpdateStep StepName="SideQuestLore#0010Alt-Step1" State="InProgress" />
      <Action_LockQuestTarget TargetVarName="$InitialVillagePointOfInterest" LockOption="Lock"/>

      <Controller_Parallel CompletionPolicy="Any">

        <Controller_Sequence>
      <!--Step 1 - WIN-->
      <Controller_Parallel CompletionPolicy="Any">

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite>
              <Prerequisites Target="$DustProductionEmpireCity">
                <InterpreterPrerequisite Flags="Prerequisite">$Property(ClassCity:NetCityMoney) ge $(MaxDustProductionObjective)</InterpreterPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0010Alt-Step1" State="Completed" />
        </Controller_Sequence>

        <!--Step 1 - Fail Condition 3 - City is destroyed-->
        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite Inverted="true">
              <Prerequisites Target="$DustProductionEmpireCity">
                <PathPrerequisite Flags="Prerequisite">ClassCity</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateQuest State="Failed"/>
          <Action_UpdateStep StepName="SideQuestLore#0010Alt-Step2" State="Failed"/>
        </Controller_Sequence>

      </Controller_Parallel>

      <!--Step2 - WIN -->

      <Action_UpdateStep StepName="SideQuestLore#0010Alt-Step2" State="InProgress"/>
      <Controller_Parallel CompletionPolicy="Any">

        <Controller_Sequence>
          <Action_StartTimer Output_TimerVarName="$TimeBeforeQuestComplete"/>
          <Action_UpdateTimerLocalization TurnCountBeforeTimeOut="6" TimerLocalizationKey="$Timer" TimerVarName="$TimeBeforeQuestComplete"/>
          <Action_AddQuestMarker TargetEntityVarName="$InitialVillagePointOfInterest" Tags="Village" RevealUnexploredLand="false" MarkerVisibleInFogOfWar="false" Output_QuestMarkerVarName="$QuestMarkerInitialVillagePointOfInterest"/>

          <Decorator_Talk TargetEntityVarName="$InitialVillagePointOfInterest" PrerequisiteNotVerifiedMessage="%QuestPrerequisiteNotVerified" Initiator="Empire">
            <ConditionCheck_HasResourceAmount ResourceNameVarName="$DustResource" WantedAmountVarName="$DustAmount"/>
          </Decorator_Talk>
          <Action_TransferResource ResourceNameVarName="$DustResource" AmountVarName="$DustTransfertAmount"/>
          <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerInitialVillagePointOfInterest"/>
          <Action_PacifyMinorFaction TargetEmpireVarName="$Tribe"/>
          <Action_UpdateStep StepName="SideQuestLore#0010Alt-Step2" State="Completed"/>
          <Action_UpdateQuest State="Completed"/>
        </Controller_Sequence>

        <!--Step 2 - Fail Condition 1 - Timer ended-->
        <Controller_Sequence>
          <Decorator_TimerEnded TimerVarName="$TimeBeforeQuestComplete" TurnCountBeforeTimeOut="6" TimerLocalizationKey="$Timer" Initiator="Empire"/>
          <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerInitialVillagePointOfInterest"/>
          <Action_UpdateQuest State="Failed"/>
        </Controller_Sequence>

      </Controller_Parallel>

      <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerInitialVillagePointOfInterest"/>
      <Action_LockQuestTarget TargetVarName="$InitialVillagePointOfInterest" LockOption="Unlock"/>
    </Controller_Sequence>

        <!--Fail Condition 2 - Village is pacified-->
        <Controller_Sequence>
      <Decorator_VillagesPacified VillagesVarName="$InitialVillage" TargetOption="All" Initiator="AllEmpires"/>
      <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerInitialVillagePointOfInterest"/>
      <Action_LockQuestTarget TargetVarName="$InitialVillagePointOfInterest" LockOption="Unlock"/>
      <Action_UpdateQuest State="Failed"/>
      <Action_UpdateStep StepName="SideQuestLore#0010Alt-Step2" State="Failed"/>
    </Controller_Sequence>

        <!--Fail Condition 3 - Village is destroyed-->
        <Controller_Sequence>
      <Decorator_VillagesDestroyed VillagesVarName="$InitialVillage" TargetOption="All" Initiator="AllEmpires"/>
      <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerInitialVillagePointOfInterest"/>
      <Action_LockQuestTarget TargetVarName="$InitialVillagePointOfInterest" LockOption="Unlock"/>
      <Action_UpdateQuest State="Failed"/>
      <Action_UpdateStep StepName="SideQuestLore#0010Alt-Step2" State="Failed"/>
    </Controller_Sequence>

       </Controller_Parallel>

    </Controller_Sequence>

    <!--============ REWARDS ============-->
    <Steps>
      <Step Name="SideQuestLore#0010Alt-Step1">
        <Reward Droplist="DroplistLoreQuestDorgeshiSpearReward" Picks="1"/>
      </Step>
      <Step Name="SideQuestLore#0010Alt-Step2">
        <Reward LocalizationKey="%Pacification"/>
      </Step>
    </Steps>

  </QuestDefinition>

  <!-- ============ A Faith of Fire / Kazanji ============-->
  <QuestDefinition Name="SideQuestLore#0011" Category="SideQuest" SubCategory="Minor"
                      Cooldown="20" SkipLockedQuestTarget="true" NumberOfConcurrentInstances="1" NumberOfOccurencesPerEmpire="3" NumberOfOccurencesPerGame="0">

    <!--============ TAGS ============-->
    <Tags>BeginTurn</Tags>

    <!--Prerequisite-->
    <Prerequisites Target="$(Empire)">
      <DownloadableContentPrerequisite Flags="Prerequisite">LoreQuestsPack</DownloadableContentPrerequisite>
      <PathPrerequisite Flags="Prerequisite">../EmpireTypeMajor/AffinityKazanji</PathPrerequisite>
    </Prerequisites>

    <!--============ VARIABLES============-->
    <Vars>

      <Var VarName="$InstigatorEmpire">
        <From Source="$Empire"/>
      </Var>

      <!--Set Empire Cities-->
      <Var VarName="$EmpireCities">
        <From Source="$Empire.$Cities"/>
      </Var>

      <!--Set the City with at least 2 Kazanji Units in garrison-->
      <Var VarName="$CityWithKazanjiUnitsInGarrison">
        <Any>
          <From Source="$EmpireCities">
            <Where>
              <InterpreterPrerequisite Flags="Prerequisite">$Count(Garrison/ClassUnit,UnitTypeKazanjiDevil) ge 2</InterpreterPrerequisite>
            </Where>
          </From>
        </Any>
      </Var>

      <LocalizationVar LocalizationKey="$City" Source="$CityWithKazanjiUnitsInGarrison"/>

    </Vars>

    <!--============ SEQUENCE ============-->

    <Controller_Sequence>
      <Action_UpdateStep StepName="SideQuestLore#0011-Step1" State="InProgress" />

      <Controller_Parallel CompletionPolicy ="Any">
        <!--Step 1 and 2 parallel with failure condition-->
        <Controller_Sequence>
          <Controller_Parallel CompletionPolicy ="Any">
            <!--Step 1 - Having a full garrison of Kazanji Units in a City-->

            <Controller_Sequence>
              <!--Step 1 - 4 Units / No army slots techs-->
              <Controller_Parallel CompletionPolicy ="All">
                <Controller_Sequence>
                  <Decorator_BeginTurn Initiator="Empire">
                    <ConditionCheck_Prerequisite>
                      <Prerequisites Target="$CityWithKazanjiUnitsInGarrison">
                        <InterpreterPrerequisite Flags="Prerequisite">$Count(Garrison/ClassUnit,UnitTypeKazanjiDevil) eq 4</InterpreterPrerequisite>
                      </Prerequisites>
                    </ConditionCheck_Prerequisite>
                  </Decorator_BeginTurn>
                </Controller_Sequence>
                <Controller_Sequence>
                  <Decorator_BeginTurn Initiator="Empire">
                    <ConditionCheck_Prerequisite>
                      <Prerequisites Target="$Empire">
                        <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, !TechnologyArmySize1</PathPrerequisite>
                        <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, !TechnologyArmySize2</PathPrerequisite>
                      </Prerequisites>
                    </ConditionCheck_Prerequisite>
                  </Decorator_BeginTurn>
                </Controller_Sequence>
              </Controller_Parallel>
              <Action_UpdateStep StepName="SideQuestLore#0011-Step1" State="Completed"/>
            </Controller_Sequence>

            <Controller_Sequence>
              <!--Step 1 - 6 Units / 1st army slots tech-->
              <Controller_Parallel CompletionPolicy ="All">
                <Controller_Sequence>
                  <Decorator_BeginTurn Initiator="Empire">
                    <ConditionCheck_Prerequisite>
                      <Prerequisites Target="$CityWithKazanjiUnitsInGarrison">
                        <InterpreterPrerequisite Flags="Prerequisite">$Count(Garrison/ClassUnit,UnitTypeKazanjiDevil) eq 6</InterpreterPrerequisite>
                      </Prerequisites>
                    </ConditionCheck_Prerequisite>
                  </Decorator_BeginTurn>
                </Controller_Sequence>
                <Controller_Sequence>
                  <Decorator_BeginTurn Initiator="Empire">
                    <ConditionCheck_Prerequisite>
                      <Prerequisites Target="$Empire">
                        <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyArmySize1</PathPrerequisite>
                        <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, !TechnologyArmySize2</PathPrerequisite>
                      </Prerequisites>
                    </ConditionCheck_Prerequisite>
                  </Decorator_BeginTurn>
                </Controller_Sequence>
              </Controller_Parallel>
              <Action_UpdateStep StepName="SideQuestLore#0011-Step1" State="Completed"/>
            </Controller_Sequence>

            <Controller_Sequence>
              <!--Step 1 - 6 Units / 2nd army slots tech-->
              <Controller_Parallel CompletionPolicy ="All">
                <Controller_Sequence>
                  <Decorator_BeginTurn Initiator="Empire">
                    <ConditionCheck_Prerequisite>
                      <Prerequisites Target="$CityWithKazanjiUnitsInGarrison">
                        <InterpreterPrerequisite Flags="Prerequisite">$Count(Garrison/ClassUnit,UnitTypeKazanjiDevil) eq 6</InterpreterPrerequisite>
                      </Prerequisites>
                    </ConditionCheck_Prerequisite>
                  </Decorator_BeginTurn>
                  <Decorator_BeginTurn Initiator="Empire">
                    <ConditionCheck_Prerequisite>
                      <Prerequisites Target="$Empire">
                        <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, !TechnologyArmySize1</PathPrerequisite>
                        <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyArmySize2</PathPrerequisite>
                      </Prerequisites>
                    </ConditionCheck_Prerequisite>
                  </Decorator_BeginTurn>

                  <Action_UpdateStep StepName="SideQuestLore#0011-Step1" State="Completed"/>
                </Controller_Sequence>
              </Controller_Parallel>
            </Controller_Sequence>

            <Controller_Sequence>
              <!--Step 1 - 8 Units / Both army slots tech-->
              <Controller_Parallel CompletionPolicy ="All">
                <Controller_Sequence>
                  <Decorator_BeginTurn Initiator="Empire">
                    <ConditionCheck_Prerequisite>
                      <Prerequisites Target="$CityWithKazanjiUnitsInGarrison">
                        <InterpreterPrerequisite Flags="Prerequisite">$Count(Garrison/ClassUnit,UnitTypeKazanjiDevil) eq 8</InterpreterPrerequisite>
                      </Prerequisites>
                    </ConditionCheck_Prerequisite>
                  </Decorator_BeginTurn>
                  <Decorator_BeginTurn Initiator="Empire">
                    <ConditionCheck_Prerequisite>
                      <Prerequisites Target="$Empire">
                        <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyArmySize1</PathPrerequisite>
                        <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyArmySize2</PathPrerequisite>
                      </Prerequisites>
                    </ConditionCheck_Prerequisite>
                  </Decorator_BeginTurn>

                  <Action_UpdateStep StepName="SideQuestLore#0011-Step1" State="Completed"/>
                </Controller_Sequence>
              </Controller_Parallel>
            </Controller_Sequence>

          </Controller_Parallel>

          <!--Step 2 - Keep the Garrison full of Kazanji Units during 7 turns-->
          <Action_UpdateStep StepName="SideQuestLore#0011-Step2" State="InProgress" />
          <Controller_Loop LoopCount="7">
            <Decorator_BeginTurn Initiator="Empire" LinkedStepProgression="SideQuestLore#0011-Step2">
              <ConditionCheck_Prerequisite>
                <Prerequisites Target="$CityWithKazanjiUnitsInGarrison">
                  <InterpreterPrerequisite Flags="Prerequisite">$Count(Garrison/ClassUnit,UnitTypeKazanjiDevil) ge 4</InterpreterPrerequisite>
                </Prerequisites>
              </ConditionCheck_Prerequisite>
            </Decorator_BeginTurn>
          </Controller_Loop>
          <Action_ActivateBooster BoosterDefinitionName="BoosterLuxury10"/>
          <Action_UpdateStep StepName="SideQuestLore#0011-Step2" State="Completed" />
          <Action_UpdateQuest State="Completed"/>
        </Controller_Sequence>

        <!--Fail Condition 2 - Faction no longer assimilated-->
        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite>
              <Prerequisites Target="$Empire">
                <PathPrerequisite Inverted="true" Flags="Prerequisite">../EmpireTypeMajor/AffinityKazanji</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateQuest State="Failed"/>
        </Controller_Sequence>

      </Controller_Parallel>
    </Controller_Sequence>

    <!--============ REWARDS ============-->
    <Steps>
      <Step Name="SideQuestLore#0011-Step1">
        <Reward Droplist="DroplistDust" Picks="1"/>
      </Step>
      <Step Name="SideQuestLore#0011-Step2">
        <Reward LocalizationKey="%SideQuestLore#0011-Step2Reward"/>
        <ProgressionRange StartValue="0" EndValue="7"/>
      </Step>
    </Steps>

  </QuestDefinition>

  <!-- ============ Conflict Resolution - Chapter 1 / Jotus and Hurnas  ============-->
  <QuestDefinition Name="SideQuestLore#0012" Category="SideQuest" SubCategory="Minor"
                      Cooldown="1" SkipLockedQuestTarget="true" NumberOfConcurrentInstances="1" NumberOfOccurencesPerEmpire="1" NumberOfOccurencesPerGame="0">

    <!--============ TAGS ============-->
    <Tags>Interact</Tags>

    <!--Prerequisite-->
    <Prerequisites Target="$(Empire)">
      <InterpreterPrerequisite Flags="Prerequisite">$Property(ClassEmpire:CurrentTurn) ge (35 * $Property(ClassEmpire:GameSpeedMultiplier))</InterpreterPrerequisite>
      <DownloadableContentPrerequisite Flags="Prerequisite">LoreQuestsPack</DownloadableContentPrerequisite>
    </Prerequisites>

    <!--============ VARIABLES============-->
    <Vars>

      <Var VarName="$InstigatorEmpire">
        <From Source="$Empire"/>
      </Var>

      <Var VarName="$InitialRuin">
        <From Source="$TargetPointsOfInterest"/>
      </Var>

      <Var VarName="$InitialRuinLocation">
        <From Source="$TargetPointsOfInterest.$Position"/>
      </Var>

      <!--Get the position of the Quest POI region-->
      <Var VarName="$InitialRuinRegionLocation">
        <From Source="$Region.$Position"/>
      </Var>

      <Var VarName="$AllRegions">
        <From Source="$Regions">
          <Where>
            <FilterRegionIsContinent/>
          </Where>
        </From>
      </Var>

      <Var VarName="$VillageJotus">
        <Any>
          <From Source="$AllRegions.$PointsOfInterest">
            <Where>
              <PathPrerequisite Flags="Prerequisite">VillageTypeJotus</PathPrerequisite>
            </Where>
          </From>
        </Any>
      </Var>
      <Var VarName="$VillageHurnas">
        <Any>
          <From Source="$AllRegions.$PointsOfInterest">
            <Where>
              <PathPrerequisite Flags="Prerequisite">VillageTypeHurnas</PathPrerequisite>
            </Where>
          </From>
        </Any>
      </Var>

      <Var VarName="$AllRegionsButRuinRegion">
        <From Source="$AllRegions">
          <Where>
            <FilterRegionByDistance PositionToCompareVarName="$InitialRuinRegionLocation" DistanceMax="1"/>
          </Where>
        </From>
      </Var>

      <Var VarName="$FirstArmySpawn">
        <Limit LimitMin="1" LimitMax="2">
          <From Source="$AllRegionsButRuinRegion.$PointsOfInterest">
            <Where>
              <PathPrerequisite Flags="Prerequisite">PointOfInterestTypeVillage</PathPrerequisite>
            </Where>
          </From>
        </Limit>
      </Var>

      <Var VarName="$FirstArmySpawnLocation">
        <From Source="$FirstArmySpawn.$Position"/>
      </Var>

      <Var VarName="$AnotherRegion">
        <From Source="$AllRegions">
          <Where>
            <FilterRegionByDistance PositionToCompareVarName="$InitialRuinRegionLocation" DistanceMax="1"/>
          </Where>
        </From>
      </Var>

      <Var VarName="$SecondArmySpawn">
        <Limit LimitMin="1" LimitMax="2">
          <From Source="$AnotherRegion.$PointsOfInterest">
            <Where>
              <PathPrerequisite Flags="Prerequisite">PointOfInterestTypeResourceDeposit</PathPrerequisite>
            </Where>
          </From>
        </Limit>
      </Var>

      <Var VarName="$SecondArmySpawnLocation">
        <From Source="$SecondArmySpawn.$Position"/>
      </Var>

    </Vars>

    <!--============ SEQUENCE ============-->

    <Controller_Sequence>
      <Action_UpdateStep StepName="SideQuestLore#0012-Step1" HideRewards="true" State="InProgress" />
      <!--The First Army Spawn and Marker added and loot item after death-->
      <Action_SpawnArmy CanMoveOnSpawn="false" SpawnLocationVarName="$FirstArmySpawnLocation" ArmyDroplist="DroplistArmyDefinitionMainQuestRageWizardsChapter2Step3_Hurnas" Output_EnemyArmyGUIDVarName="$ArmyID1"/>
      <Action_UpdateArmyObjective ArmyGUIDVarName="$ArmyID1" BehaviourName="PacifistRoaming"/>
      <Action_AddQuestMarker TargetEntityVarName="$FirstArmySpawn" Tags="YoplaitFraise" RevealUnexploredLand="true" MarkerVisibleInFogOfWar="true" Output_QuestMarkerVarName="$QuestMarkerPointOfInterestToInspect1"/>

      <!--The Second Army Spawn and Marker added and loot item after death-->
      <Action_SpawnArmy CanMoveOnSpawn="false" SpawnLocationVarName="$SecondArmySpawnLocation" ArmyDroplist="DroplistArmyDefinitionMainQuestRageWizardsChapter2Step3_Jotus" Output_EnemyArmyGUIDVarName="$ArmyID2"/>
      <Action_UpdateArmyObjective ArmyGUIDVarName="$ArmyID2" BehaviourName="PacifistRoaming"/>
      <Action_AddQuestMarker TargetEntityVarName="$SecondArmySpawn" Tags="YoplaitFraise" RevealUnexploredLand="true" MarkerVisibleInFogOfWar="true" Output_QuestMarkerVarName="$QuestMarkerPointOfInterestToInspect2"/>

      <Controller_Parallel CompletionPolicy="Any">
      <!--Win condition with removing highlight on following turn after spawn-->
        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire"/>
          <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerPointOfInterestToInspect1"/>
          <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerPointOfInterestToInspect2"/>
          <!--Player's Action-->
          <Controller_Parallel CompletionPolicy="Any">
            <!--Kill the Hurnas-->
            <Controller_Sequence>
              <Decorator_KillArmy TargetOption="All" Initiator="Empire">
                <EnemyArmyGUIDVarName>$ArmyID1</EnemyArmyGUIDVarName>
              </Decorator_KillArmy>
              <Action_DestroyArmy ArmyGUIDVarName="$ArmyID2" />
              <!--FAIRE LOOTER UN OBJET PRECIS-->
              <Action_ForceUnlockTechnology TechnologyDefinitionName="TechnologyDefinitionItemTalismanDustLoreQuest12"/>

              <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerPointOfInterestToInspect1"/>
              <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerPointOfInterestToInspect2"/>
              <Action_UpdateStep StepName="SideQuestLore#0012-Step1" State="Completed" />
              <Action_UpdateQuest State="Completed"/>
            </Controller_Sequence>

            <!--Or Kill the Jotus-->
            <Controller_Sequence>
              <Decorator_KillArmy TargetOption="All" Initiator="Empire">
                <EnemyArmyGUIDVarName>$ArmyID2</EnemyArmyGUIDVarName>
              </Decorator_KillArmy>
              <Action_DestroyArmy ArmyGUIDVarName="$ArmyID1" />
              <!--FAIRE LOOTER UN OBJET PRECIS-->
              <Action_ForceUnlockTechnology TechnologyDefinitionName="TechnologyDefinitionItemTorsoDustLoreQuest12"/>
              <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerPointOfInterestToInspect1"/>
              <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerPointOfInterestToInspect2"/>
              <Action_UpdateStep StepName="SideQuestLore#0012-Step1" State="Completed" />
              <Action_UpdateQuest State="Completed"/>
            </Controller_Sequence>
          </Controller_Parallel>
        </Controller_Sequence>

      <!--Win condition if player kill army the turn they spawn-->
        <Controller_Sequence>
        <!--Player's Action-->
        <Controller_Parallel CompletionPolicy="Any">
          <!--Kill the Hurnas-->
          <Controller_Sequence>
            <Decorator_KillArmy TargetOption="All" Initiator="Empire">
              <EnemyArmyGUIDVarName>$ArmyID1</EnemyArmyGUIDVarName>
            </Decorator_KillArmy>
            <Action_DestroyArmy ArmyGUIDVarName="$ArmyID2" />
            <!--FAIRE LOOTER UN OBJET PRECIS-->
            <Action_ForceUnlockTechnology TechnologyDefinitionName="TechnologyDefinitionItemTalismanDustLoreQuest12"/>

            <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerPointOfInterestToInspect1"/>
            <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerPointOfInterestToInspect2"/>
            <Action_UpdateStep StepName="SideQuestLore#0012-Step1" State="Completed" />
            <Action_UpdateQuest State="Completed"/>
          </Controller_Sequence>

          <!--Or Kill the Jotus-->
          <Controller_Sequence>
            <Decorator_KillArmy TargetOption="All" Initiator="Empire">
              <EnemyArmyGUIDVarName>$ArmyID2</EnemyArmyGUIDVarName>
            </Decorator_KillArmy>
            <Action_DestroyArmy ArmyGUIDVarName="$ArmyID1" />
            <!--FAIRE LOOTER UN OBJET PRECIS-->
            <Action_ForceUnlockTechnology TechnologyDefinitionName="TechnologyDefinitionItemTorsoDustLoreQuest12"/>
            <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerPointOfInterestToInspect1"/>
            <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerPointOfInterestToInspect2"/>
            <Action_UpdateStep StepName="SideQuestLore#0012-Step1" State="Completed" />
            <Action_UpdateQuest State="Completed"/>
          </Controller_Sequence>
        </Controller_Parallel>

      </Controller_Sequence>

      <!--Fail condition if other empires kill the armies-->
        <Controller_Sequence>
        <Controller_Parallel CompletionPolicy="Any">
          <Controller_Sequence>
            <Decorator_KillArmy TargetOption="All" Initiator="OtherEmpires">
              <EnemyArmyGUIDVarName>$ArmyID1</EnemyArmyGUIDVarName>
            </Decorator_KillArmy>
            <Action_DestroyArmy ArmyGUIDVarName="$ArmyID2" />
          </Controller_Sequence>
          <Controller_Sequence>
            <Decorator_KillArmy TargetOption="All" Initiator="OtherEmpires">
              <EnemyArmyGUIDVarName>$ArmyID2</EnemyArmyGUIDVarName>
            </Decorator_KillArmy>
            <Action_DestroyArmy ArmyGUIDVarName="$ArmyID1" />
          </Controller_Sequence>
        </Controller_Parallel>
        <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerPointOfInterestToInspect1"/>
        <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerPointOfInterestToInspect2"/>
        <Action_UpdateQuest State="Failed"/>
      </Controller_Sequence>

      </Controller_Parallel>
    </Controller_Sequence>

    <!--============ REWARDS ============-->
    <Steps>
      <Step Name="SideQuestLore#0012-Step1">
        <Reward Droplist="DroplistMadFairiesMainQuestRewards" Picks="1"/>
        <Reward LocalizationKey="%SideQuestLore#0012-Step1TrophyReward"/>
      </Step>
    </Steps>

  </QuestDefinition>

  <!-- ============ Conflict Resolution - Chapter 2 / Jotus  ============-->
  <QuestDefinition Name="SideQuestLore#0012Jotus" Category="SideQuest" SubCategory="Minor"
                      Cooldown="1" SkipLockedQuestTarget="true" NumberOfConcurrentInstances="1" NumberOfOccurencesPerEmpire="1" NumberOfOccurencesPerGame="0">

    <!--============ TAGS ============-->
    <Tags>BeginTurn</Tags>

    <!--Prerequisite-->
    <Prerequisites Target="$(Empire)">
      <PathPrerequisite Inverted="true" Flags="Prerequisite">EmpireTypeMajor,FactionTraitNecrophages5</PathPrerequisite>      <!--Pitiless trait-->
      <DownloadableContentPrerequisite Flags="Prerequisite">LoreQuestsPack</DownloadableContentPrerequisite>
      <PathPrerequisite Flags="Prerequisite">../ClassEmpire/TechnologyItemTalismanDustLoreQuest12</PathPrerequisite>
      <QuestStatePrerequisite QuestDefinitionName="SideQuestLore#0012" QuestState="Completed"/>
      <QuestStatePrerequisite Inverted="true" QuestDefinitionName="SideQuestLore#0012Hurnas" QuestState="Completed"/>
      <QuestStatePrerequisite Inverted="true" QuestDefinitionName="SideQuestLore#0012Hurnas" QuestState="InProgress"/>
      <QuestStatePrerequisite Inverted="true" QuestDefinitionName="SideQuestLore#0012Hurnas" QuestState="Unstarted"/>

    </Prerequisites>

    <!--============ VARIABLES============-->
    <Vars>

      <Var VarName="$InstigatorEmpire">
        <From Source="$Empire"/>
      </Var>

      <Var VarName="$AllRegions">
        <From Source="$Regions"/>
      </Var>

      <Var VarName="$Village01">
        <Any>
          <From Source="$AllRegions.$PointsOfInterest">
            <Where>
              <PathPrerequisite Flags="Prerequisite">VillageTypeJotus</PathPrerequisite>
            </Where>
          </From>
        </Any>
      </Var>

      <Var VarName="$Village01Location">
        <From Source="$Village01.$Position"/>
      </Var>

    </Vars>

    <!--============ SEQUENCE ============-->

    <Controller_Sequence>

      <Action_UpdateStep StepName="SideQuestLore#0012Jotus-Step1" State="InProgress" />
      <Controller_Sequence>
        <Action_AddQuestMarker TargetEntityVarName="$Village01" Tags="Village" RevealUnexploredLand="true" MarkerVisibleInFogOfWar="true" Output_QuestMarkerVarName="$QuestMarkerPointOfInterestToInspect1"/>
        <Decorator_Talk TargetEntityVarName="$Village01" Output_InstigatorSimObjectVarName="$InspectionInstigatorSimObject" Initiator="Empire" PrerequisiteNotVerifiedMessage="%QuestPrerequisiteNotVerified">
          <ConditionCheck_Prerequisite>
            <Prerequisites Target="$InspectionInstigatorSimObject">
              <PathPrerequisite Flags="Prerequisite">ClassArmy/ClassUnit,UnitRankHero/ItemAttributesTalismanDustLoreQuest12</PathPrerequisite>
            </Prerequisites>
          </ConditionCheck_Prerequisite>
        </Decorator_Talk>
      </Controller_Sequence>
      <Action_SpawnArmy SpawnLocationVarName="$Village01Location" ArmyDroplist="DroplistArmyDefinition_Jotus" ForbiddenSpawnLocationVarName="$ForbiddenSpawnLocation" Output_EnemyArmyGUIDVarName="$ArmyID" EmpireArmyOwnerVarName="$InstigatorEmpire"/>
      <Action_UpdateStep StepName="SideQuestLore#0012Jotus-Step1" State="Completed"/>
      <Action_UpdateQuest State="Completed"/>
      <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerPointOfInterestToInspect1"/>
    </Controller_Sequence>

    <!--============ REWARDS ============-->
    <Steps>
      <Step Name="SideQuestLore#0012Jotus-Step1">
        <Reward Droplist="DroplistMadFairiesMainQuestRewards" Picks="1"/>
        <Reward LocalizationKey="%SideQuestLore#0012Jotus-Step1Reward"/>
      </Step>
    </Steps>

  </QuestDefinition>

  <!-- ============ Conflict Resolution - Chapter 2 / Hurnas  ============-->
  <QuestDefinition Name="SideQuestLore#0012Hurnas" Category="SideQuest" SubCategory="Minor"
                      Cooldown="1" SkipLockedQuestTarget="true" NumberOfConcurrentInstances="1" NumberOfOccurencesPerEmpire="1" NumberOfOccurencesPerGame="0">

    <!--============ TAGS ============-->
    <Tags>BeginTurn</Tags>

    <!--======== Prerequisite =======-->
    <Prerequisites Target="$(Empire)">
      <PathPrerequisite Inverted="true" Flags="Prerequisite">EmpireTypeMajor,FactionTraitNecrophages5</PathPrerequisite>      <!--Pitiless trait-->
      <DownloadableContentPrerequisite Flags="Prerequisite">LoreQuestsPack</DownloadableContentPrerequisite>
      <PathPrerequisite Flags="Prerequisite">../ClassEmpire/TechnologyItemTorsoDustLoreQuest12</PathPrerequisite>
      <QuestStatePrerequisite QuestDefinitionName="SideQuestLore#0012" QuestState="Completed"/>
      <QuestStatePrerequisite Inverted="true" QuestDefinitionName="SideQuestLore#0012Jotus" QuestState="Completed"/>
      <QuestStatePrerequisite Inverted="true" QuestDefinitionName="SideQuestLore#0012Jotus" QuestState="InProgress"/>
      <QuestStatePrerequisite Inverted="true" QuestDefinitionName="SideQuestLore#0012Jotus" QuestState="Unstarted"/>
    </Prerequisites>

    <!--============ VARIABLES============-->
    <Vars>

      <Var VarName="$InstigatorEmpire">
        <From Source="$Empire"/>
      </Var>

      <Var VarName="$AllRegions">
        <From Source="$Regions"/>
      </Var>

      <Var VarName="$Village02">
        <Any>
          <From Source="$AllRegions.$PointsOfInterest">
            <Where>
              <PathPrerequisite Flags="Prerequisite">VillageTypeHurnas</PathPrerequisite>
            </Where>
          </From>
        </Any>
      </Var>

      <Var VarName="$Village02Location">
        <From Source="$Village02.$Position"/>
      </Var>

    </Vars>

    <!--============ SEQUENCE ============-->

    <Controller_Sequence>
      <Action_UpdateStep StepName="SideQuestLore#0012Hurnas-Step1" State="InProgress" />

      <Controller_Sequence>
        <Action_AddQuestMarker TargetEntityVarName="$Village02" Tags="Village" RevealUnexploredLand="true" MarkerVisibleInFogOfWar="true" Output_QuestMarkerVarName="$QuestMarkerPointOfInterestToInspect2"/>
        <Decorator_Talk TargetEntityVarName="$Village02" Output_InstigatorSimObjectVarName="$InspectionInstigatorSimObject" Initiator="Empire" PrerequisiteNotVerifiedMessage="%QuestPrerequisiteNotVerified">
          <ConditionCheck_Prerequisite>
            <Prerequisites Target="$InspectionInstigatorSimObject">
              <PathPrerequisite Flags="Prerequisite">ClassArmy/ClassUnit,UnitRankHero/ItemAttributesTorsoDustLoreQuest12</PathPrerequisite>
            </Prerequisites>
          </ConditionCheck_Prerequisite>
        </Decorator_Talk>
      </Controller_Sequence>

      <Action_SpawnArmy SpawnLocationVarName="$Village02Location" ArmyDroplist="DroplistArmyDefinition_Hurnas" ForbiddenSpawnLocationVarName="$ForbiddenSpawnLocation" Output_EnemyArmyGUIDVarName="$ArmyID" EmpireArmyOwnerVarName="$InstigatorEmpire"/>

      <Action_UpdateStep StepName="SideQuestLore#0012Hurnas-Step1" State="Completed"/>
      <Action_UpdateQuest State="Completed"/>
      <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerPointOfInterestToInspect2"/>
    </Controller_Sequence>


    <!--============ REWARDS ============-->
    <Steps>
      <Step Name="SideQuestLore#0012Hurnas-Step1">
        <Reward Droplist="DroplistMadFairiesMainQuestRewards" Picks="1"/>
        <Reward LocalizationKey="%SideQuestLore#0012Hurnas-Step1Reward"/>
      </Step>
    </Steps>

  </QuestDefinition>

  <!-- ============ The Gauran Games / Gauran ============-->
  <QuestDefinition Name="SideQuestLore#0013" Category="SideQuest" SubCategory="Minor"
                     Cooldown="10" SkipLockedQuestTarget="true" NumberOfConcurrentInstances="1" NumberOfOccurencesPerEmpire="2" NumberOfOccurencesPerGame="0">

    <!--============ TAGS ============-->
    <Tags>Talk</Tags>

    <!--======== Prerequisite =======-->
    <Prerequisites Target="$(Empire)">
      <DownloadableContentPrerequisite Flags="Prerequisite">LoreQuestsPack</DownloadableContentPrerequisite>
      <QuestStatePrerequisite Inverted="true" QuestDefinitionName="SideQuestNavalInteract#0013" QuestState="InProgress"/>
      <QuestStatePrerequisite Inverted="true" QuestDefinitionName="SideQuestNavalInteract#0013" QuestState="Unstarted"/>
    </Prerequisites>

      <!--============ VARIABLES============-->

    <Vars>

      <!--Check the number of pacified villages as prerequisite-->
      <Var VarName="$InitialTribeRegion">
        <From Source="$TargetVillage.$PointOfInterest.$Position.$Region">
          <Where>
            <InterpreterPrerequisite Flags="Prerequisite">$Count(ClassEmpire/MinorEmpireVillage,!PacifiedVillage) le 2</InterpreterPrerequisite>
            <InterpreterPrerequisite Flags="Prerequisite">$Count(ClassEmpire/MinorEmpireVillage,!ConvertedVillage) le 2</InterpreterPrerequisite>
          </Where>
        </From>
      </Var>

      <!--Select only the Gauran-->
      <Var VarName="$Tribe">
        <From Source="$TargetVillage.$MinorEmpire">
          <Where>
            <PathPrerequisite Flags="Prerequisite">AffinityGauran</PathPrerequisite>
          </Where>
        </From>
      </Var>

      <Var VarName="$InitialVillage">
        <From Source="$TargetVillage"/>
      </Var>

      <Var VarName="$InitialVillagePointOfInterest">
        <From Source="$TargetPointsOfInterest"/>
      </Var>

      <Var VarName="$SpawnArmyPosition">
        <From Source="$TargetPointsOfInterest.$Position"/>
      </Var>

      <Var VarName="$InstigatorEmpire">
        <From Source="$Empire"/>
      </Var>

      <LocalizationVar LocalizationKey="$MinorFaction" Source="$Tribe"/>
      <LocalizationVar LocalizationKey="$InitialTribeRegionName" Source="$InitialTribeRegion"/>

    </Vars>

    <!--============ SEQUENCE ============-->
    <Controller_Sequence>

      <Controller_Parallel CompletionPolicy="Any">

        <Controller_Sequence>
          <!--Step 1-->
          <Action_UpdateStep StepName="SideQuestLore#0013-Step1" State="InProgress" />
          <Action_AddQuestMarker TargetEntityVarName="$InitialVillagePointOfInterest" Tags="Village" RevealUnexploredLand="true" MarkerVisibleInFogOfWar="true" Output_QuestMarkerVarName="$QuestMarkerInitialVillagePointOfInterest"/>
          <Decorator_Talk TargetEntityVarName="$InitialVillagePointOfInterest" Output_InstigatorSimObjectVarName="$InspectionInstigatorSimObject"  Output_InstigatorGUIDVarName="$ArmyWhichInspectGUID" PrerequisiteNotVerifiedMessage="%QuestPrerequisiteNotVerified" Initiator="Empire">
            <ConditionCheck_Prerequisite>
              <!--Only a hero in Army Unit talking to village, reinforcements are allowed-->
              <Prerequisites Target="$InspectionInstigatorSimObject">
                <PathPrerequisite Flags="Prerequisite">ClassArmy/ClassUnit,UnitRankHero</PathPrerequisite>
                <PathPrerequisite Inverted="true" Flags="Prerequisite">ClassArmy/ClassUnit,UnitRankStandard</PathPrerequisite>
                <InterpreterPrerequisite Flags="Prerequisite">$Count(ClassArmy/ClassUnit) eq 1</InterpreterPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_Talk>
          <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerInitialVillagePointOfInterest" />
          <!--Make a Gauran Unit spawn on initial village-->
          <Action_SpawnArmy ArmyDroplist="DroplistArmyDefinitionLoreQuest0013" SpawnLocationVarName="$SpawnArmyPosition" Output_EnemyArmyGUIDVarName="$ArmyID"/>
          
		  <!-- ELCP: moved all gauran related fail conditions here, so they only get checked after it spawned -->
		  <Controller_Parallel CompletionPolicy="Any">
			<!-- Success: Win the battle against the Gauran Unit -->
			<Controller_Sequence>
				<Decorator_KillArmy Output_WinnerVarName="$EmpireArmy" TargetOption="All" Initiator="Empire">
				<EnemyArmyGUIDVarName>$ArmyID</EnemyArmyGUIDVarName>
				<ConditionCheck_Prerequisite>
				  <Prerequisites Target="$EmpireArmy">
					<InterpreterPrerequisite Inverted="true" Flags="Prerequisite">$Count(ClassArmy/ClassUnit) gt 1</InterpreterPrerequisite>
					<PathPrerequisite Flags="Prerequisite">ClassArmy/ClassUnit,UnitRankHero</PathPrerequisite>
				  </Prerequisites>
				</ConditionCheck_Prerequisite>
				</Decorator_KillArmy>
				<Action_LockQuestTarget TargetVarName="$InitialVillagePointOfInterest" LockOption="Unlock"/>
				<Action_PacifyMinorFaction TargetEmpireVarName="$Tribe"/>
				<Action_UpdateStep StepName="SideQuestLore#0013-Step1" State="Completed"/>
				<Action_UpdateQuest State="Completed"/>
			</Controller_Sequence>
			
			<!--Fail Condition 2: Gauran Unit is killed by another empire-->
			<Controller_Sequence>
			  <Decorator_KillArmy TargetOption="All" Initiator="OtherEmpires">
				<EnemyArmyGUIDVarName>$ArmyID</EnemyArmyGUIDVarName>
			  </Decorator_KillArmy>
			  <Action_LockQuestTarget TargetVarName="$InitialVillagePointOfInterest" LockOption="Unlock"/>
			  <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerInitialVillagePointOfInterest" />
			  <Action_UpdateQuest State="Failed"/>
			</Controller_Sequence>

			<!--Fail Condition 3: Gauran Unit is killed by an army not led by a Hero-->
			<Controller_Sequence>
			  <Decorator_KillArmy Output_WinnerVarName="$EmpireArmy" TargetOption="All" Initiator="Empire">
				<EnemyArmyGUIDVarName>$ArmyID</EnemyArmyGUIDVarName>
				<ConditionCheck_Prerequisite>
				  <Prerequisites Target="$EmpireArmy">
					<PathPrerequisite Inverted="true" Flags="Prerequisite">ClassArmy/ClassUnit,UnitRankHero</PathPrerequisite>
				  </Prerequisites>
				</ConditionCheck_Prerequisite>
			  </Decorator_KillArmy>
			  <Action_LockQuestTarget TargetVarName="$InitialVillagePointOfInterest" LockOption="Unlock"/>
			  <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerInitialVillagePointOfInterest" />
			  <Action_UpdateQuest State="Failed"/>
			</Controller_Sequence>

			<!--Fail Condition 4: Gauran Unit is killed by an army composed of more than 1 Unit-->
			<Controller_Sequence>
			  <Decorator_KillArmy Output_WinnerVarName="$EmpireArmy" TargetOption="All" Initiator="Empire">
				<EnemyArmyGUIDVarName>$ArmyID</EnemyArmyGUIDVarName>
				<ConditionCheck_Prerequisite>
				  <Prerequisites Target="$EmpireArmy">
					<InterpreterPrerequisite Flags="Prerequisite">$Count(ClassArmy/ClassUnit) gt 1</InterpreterPrerequisite>
				  </Prerequisites>
				</ConditionCheck_Prerequisite>
			  </Decorator_KillArmy>
			  <Action_LockQuestTarget TargetVarName="$InitialVillagePointOfInterest" LockOption="Unlock"/>
			  <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerInitialVillagePointOfInterest" />
			  <Action_UpdateQuest State="Failed"/>
			</Controller_Sequence>

			<!--Fail Condition 5: Gauran Unit kills an army led only by 1 hero-->
			<Controller_Sequence>
			  <Decorator_KillArmy Output_LooserVarName="$EmpireArmy" TargetOption="All" Initiator="Empire">
				<ArmyGUIDVarName>$ArmyWhichInspectGUID</ArmyGUIDVarName>
				<ConditionCheck_Prerequisite>
				  <Prerequisites Target="$EmpireArmy">
					<InterpreterPrerequisite Flags="Prerequisite">$Count(ClassArmy/ClassUnit) eq 1</InterpreterPrerequisite>
					<PathPrerequisite Flags="Prerequisite">ClassArmy/UnitRankHero</PathPrerequisite>
				  </Prerequisites>
				</ConditionCheck_Prerequisite>
			  </Decorator_KillArmy>
			  <Action_LockQuestTarget TargetVarName="$InitialVillagePointOfInterest" LockOption="Unlock"/>
			  <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerInitialVillagePointOfInterest" />
			  <Action_UpdateQuest State="Failed"/>
			</Controller_Sequence>
		  </Controller_Parallel>
        </Controller_Sequence>

        <!--Fail Condition 0: initial village pacified-->
        <Controller_Sequence>
          <Decorator_VillagesPacified VillagesVarName="$InitialVillage" Initiator="AllEmpires"/>
          <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerInitialVillagePointOfInterest" />
          <Action_UpdateQuest State="Failed"/>
        </Controller_Sequence>

        <!--Fail Condition 1: initial village destroyed-->
        <Controller_Sequence>
          <Decorator_VillagesDestroyed VillagesVarName="$InitialVillage" Initiator="AllEmpires"/>
          <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerInitialVillagePointOfInterest" />
          <Action_UpdateQuest State="Failed"/>
        </Controller_Sequence>
      </Controller_Parallel>
    </Controller_Sequence>

    <!--============ REWARDS ============-->
    <Steps>
      <Step Name="SideQuestLore#0013-Step1">
        <Reward Droplist="DroplistMadFairiesMainQuestRewards" Picks="1"/>
        <Reward LocalizationKey="%Pacification"/>
      </Step>
    </Steps>

  </QuestDefinition>

  <!-- ============ Mothers in distress / Ceratan ============-->
  <QuestDefinition Name="SideQuestLore#0014" Category="SideQuest" SubCategory="Minor"
                 Cooldown="10" SkipLockedQuestTarget="true" NumberOfConcurrentInstances="1" NumberOfOccurencesPerEmpire="1" NumberOfOccurencesPerGame="0">

    <!--============ TAGS ============-->
    <Tags>Interact</Tags>

    <!--============ PREREQUISITES ============-->
    <Prerequisites Target="$(Empire)">
      <PathPrerequisite Inverted="true" Flags="Prerequisite">EmpireTypeMajor,FactionTraitCultists7</PathPrerequisite><!--No settler trait-->
      <PathPrerequisite Inverted="true" Flags="Prerequisite">EmpireTypeMajor,FactionTraitMimics1</PathPrerequisite><!--No settler trait-->
      <DownloadableContentPrerequisite Flags="Prerequisite">LoreQuestsPack</DownloadableContentPrerequisite>
      <PathPrerequisite Flags="Prerequisite">#Summer</PathPrerequisite>
      <PathPrerequisite Flags="Prerequisite">../EmpireTypeMajor/ClassResearch,TechnologyEra2</PathPrerequisite>
      <QuestStatePrerequisite Inverted="true" QuestDefinitionName="SideQuestNavalInteract#0010" QuestState="InProgress"/>
      <QuestStatePrerequisite Inverted="true" QuestDefinitionName="SideQuestNavalInteract#0010" QuestState="Unstarted"/>
    </Prerequisites>

    <!--============ VARIABLES ============-->
    <Vars>
      <!--Initial ruin -->
      <Var VarName="$InitialRuin">
        <From Source="$TargetPointsOfInterest"/>
      </Var>
	  <!-- ELCP for Army Reward -->
	  <Var VarName="$PointOfInterestToInspectLocation">
        <From Source="$InitialRuin.$Position"/>
      </Var>
	  <Var VarName="$InstigatorEmpire">
        <From Source="$Empire"/>
      </Var>
    </Vars>
    <!--============ SEQUENCE ============-->

    <Controller_Sequence>
      <Action_UpdateStep StepName="SideQuestLore#0014-Step1" State="InProgress" />

      <Action_AddQuestMarker TargetEntityVarName="$InitialRuin" Tags="Ruins" RevealUnexploredLand="true" MarkerVisibleInFogOfWar="true" Output_QuestMarkerVarName="$QuestMarkerPointOfInterestToInspect"/>
      <Decorator_Inspect TargetEntityVarName="$InitialRuin" Output_InstigatorSimObjectVarName="$InspectionInstigatorSimObject" Output_InstigatorGUIDVarName="$InspectionInstigatorGUID" PrerequisiteNotVerifiedMessage="%QuestPrerequisiteNotVerified" Initiator="Empire">
        <ConditionCheck_Prerequisite>
          <Prerequisites Target="$InspectionInstigatorSimObject">
            <InterpreterPrerequisite Flags="Prerequisite">$Count(ClassArmy/ClassUnit) eq 1</InterpreterPrerequisite>
            <PathPrerequisite Flags="Prerequisite">ClassArmy/ClassUnit,UnitSettler</PathPrerequisite>
          </Prerequisites>
        </ConditionCheck_Prerequisite>
      </Decorator_Inspect>
      <Action_DestroyArmy ArmyGUIDVarName="$InspectionInstigatorGUID" />
      <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerPointOfInterestToInspect"/>
	  <!-- ELCP new Army reward -->
	  <Action_SpawnArmy SpawnLocationVarName="$PointOfInterestToInspectLocation" ArmyDroplist="DroplistLoreQuestMotherProtectionArmyRewardELCP" EmpireArmyOwnerVarName="$InstigatorEmpire" ScaleWithMaxEra="true"/>

      <Action_UpdateStep StepName="SideQuestLore#0014-Step1" State="Completed" />
      <Action_UpdateQuest State="Completed"/>
    </Controller_Sequence>

    <!--============ REWARDS ============-->
    <Steps>
      <Step Name="SideQuestLore#0014-Step1">
        <Reward Droplist="DroplistLoreQuestMotherProtectionShieldReward" Picks="1"/>
		<Reward LocalizationKey="%ELCPSideQuestLore#0014Reward"/>
      </Step>
    </Steps>

  </QuestDefinition>

  <!-- ============ Dust Gives, Dust Takes / Birdhive ============-->
  <QuestDefinition Name="SideQuestLore#0015" Category="SideQuest" SubCategory="Minor"
                     Cooldown="7" SkipLockedQuestTarget="true" NumberOfConcurrentInstances="8" NumberOfOccurencesPerEmpire="1" NumberOfOccurencesPerGame="0">

    <!--============ TAGS ============-->
    <Tags>Interact</Tags>

    <!--============ PREREQUISITES ============-->
    <Prerequisites Target="$(Empire)">
      <DownloadableContentPrerequisite Flags="Prerequisite">LoreQuestsPack</DownloadableContentPrerequisite>
      <InterpreterPrerequisite Flags="Prerequisite">($Count(EmpireTypeMajor/ClassCity/ClassDistrict,TerrainTagAnomaly)
													+ $Count(EmpireTypeMajor/ClassCity/ConvertedVillage/ClassDistrict,TerrainTagAnomaly)
													+ $Count(EmpireTypeMajor/ClassCity/ClassCreepingNode/ClassDistrict,TerrainTagAnomaly)) ge 5</InterpreterPrerequisite>
      <InterpreterPrerequisite Flags="Prerequisite">($Count(EmpireTypeMajor/ClassCity/ClassDistrict,TerrainTagAnomaly)
													+ $Count(EmpireTypeMajor/ClassCity/ConvertedVillage/ClassDistrict,TerrainTagAnomaly)
													+ $Count(EmpireTypeMajor/ClassCity/ClassCreepingNode/ClassDistrict,TerrainTagAnomaly)) le 10</InterpreterPrerequisite>
      <QuestStatePrerequisite Inverted="true" QuestDefinitionName="SideQuestNavalInteract#0011" QuestState="InProgress"/>
      <QuestStatePrerequisite Inverted="true" QuestDefinitionName="SideQuestNavalInteract#0011" QuestState="Unstarted"/>
    </Prerequisites>
    <!--============ VARIABLES============-->

    <Vars>

      <!--Current Anomalies exploited-->
      <InterpretedVar VarName="CurrentAnomaliesExploited" Target="$(Empire)">
        <Expression>$Count(EmpireTypeMajor/ClassCity/ClassDistrict,TerrainTagAnomaly)
		            + $Count(EmpireTypeMajor/ClassCity/ConvertedVillage/ClassDistrict,TerrainTagAnomaly)
		            + $Count(EmpireTypeMajor/ClassCity/ClassCreepingNode/ClassDistrict,TerrainTagAnomaly)</Expression>
      </InterpretedVar>

      <!--Anomalies exploited objective -->
      <InterpretedVar VarName="AnomaliesExploitedObjective" Target="$(Empire)">
        <Expression>$(CurrentAnomaliesExploited) + 2</Expression>
      </InterpretedVar>

      <!--Set the city with the more NetCityMoney-->
      <Var VarName="$CityWithBestNetMoney">
        <First>
          <From Source="$Empire.$Cities">
            <OrderBy>
              <SortCitiesBySimulationProperty SortBy="Descending" PropertyName="NetCityMoney"/>
            </OrderBy>
          </From>
        </First>
      </Var>

      <!--Current Dust Production-->
      <InterpretedVar VarName="CurrentDustProduction" Target="$(Empire)">
        <Expression>$MaxProperty(EmpireTypeMajor/ClassCity:NetCityMoney)</Expression>
      </InterpretedVar>

      <!--Anomalies exploited objective -->
      <InterpretedVar VarName="DustProductionObjective" Target="$(Empire)">
        <Expression>$(CurrentDustProduction) + 30</Expression>
      </InterpretedVar>

      <!--For owning units as reward-->
      <Var VarName="$MyEmpire">
        <From Source="$Empire"/>
      </Var>

      <!--Initial ruin POI-->
      <Var VarName="$InitialRuinPOI">
        <From Source="$TargetPointsOfInterest"/>
      </Var>

      <!--Initial ruin Position-->
      <Var VarName="$InitialRuin">
        <From Source="$InitialRuinPOI.$Position"/>
      </Var>

      <LocalizationVar LocalizationKey="$AnomaliesToExploit" Source="AnomaliesExploitedObjective"/>
      <LocalizationVar LocalizationKey="$DustProductionObjective" Source="DustProductionObjective"/>

    </Vars>

    <!--============ SEQUENCE ============-->
    <Controller_Sequence>

      <!--Step 1-->
      <Action_UpdateStep StepName="SideQuestLore#0015-Step1" State="InProgress" />
      <Decorator_BeginTurn Initiator="Empire">
        <InterpretedVarsToUpdate>
          <Var>CurrentAnomaliesExploited</Var>
        </InterpretedVarsToUpdate>
        <ConditionCheck_IsStepProgressionComplete InterpretedValue="$(CurrentAnomaliesExploited)" StepName="SideQuestLore#0015-Step1" />
      </Decorator_BeginTurn>
      <Action_UpdateStep StepName="SideQuestLore#0015-Step1" State="Completed" />

      <!--Step 2-->
      <Action_UpdateStep StepName="SideQuestLore#0015-Step2" State="InProgress" />
      <Controller_Loop LoopCount="5">
        <Decorator_BeginTurn Initiator="Empire" LinkedStepProgression="SideQuestLore#0015-Step2">
          <InterpretedVarsToUpdate>
            <Var>CurrentDustProduction</Var>
          </InterpretedVarsToUpdate>
          <ConditionCheck_Prerequisite>
            <Prerequisites Target="$Empire">
              <InterpreterPrerequisite Flags="Prerequisite">$(CurrentDustProduction) ge $(DustProductionObjective)</InterpreterPrerequisite>
            </Prerequisites>
          </ConditionCheck_Prerequisite>
        </Decorator_BeginTurn>
      </Controller_Loop>
      <Action_UpdateStep StepName="SideQuestLore#0015-Step2" State="Completed" />

      <!--Step 3-->
      <Action_UpdateStep StepName="SideQuestLore#0015-Step3" State="InProgress" />
      <Action_AddQuestMarker TargetEntityVarName="$InitialRuinPOI" Tags="Ruins" RevealUnexploredLand="true" MarkerVisibleInFogOfWar="true" Output_QuestMarkerVarName="$QuestMarkerPointOfInterestToInspect"/>
      <Decorator_Inspect TargetEntityVarName="$InitialRuinPOI" Output_InstigatorSimObjectVarName="$InspectionInstigatorSimObject" Output_InstigatorGUIDVarName="$InspectionInstigatorGUID" PrerequisiteNotVerifiedMessage="%QuestPrerequisiteNotVerified" Initiator="Empire"/>
      <Action_SpawnArmy SpawnLocationVarName="$InitialRuin" ArmyDroplist="DroplistArmyDefinitionLoreQuest0015-Step2" EmpireArmyOwnerVarName="$MyEmpire"/>
      <!--Make 2 Nidya Arpuja Unit spawn on initial village-->
      <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerPointOfInterestToInspect"/>
      <Action_UpdateStep StepName="SideQuestLore#0015-Step3" State="Completed" />
      <Action_UpdateQuest State="Completed"/>

    </Controller_Sequence>

    <!--============ REWARDS ============-->
    <Steps>
      <Step Name="SideQuestLore#0015-Step1">
        <Reward Droplist="DroplistLoreQuest0015-Step1" Picks="1"/>
        <ProgressionRange StartValue="0" EndValueVarName="AnomaliesExploitedObjective"/>
        <!--Reward: EconomyTechnology from the Current Era-->
      </Step>
      <Step Name="SideQuestLore#0015-Step2">
        <ProgressionRange StartValue="0" EndValue="5"/>
        <Reward Droplist="DroplistMadFairiesMainQuestRewards" Picks="1"/>
      </Step>
      <Step Name="SideQuestLore#0015-Step3">
        <!--Reward: 2 Arpuja Units-->
        <Reward LocalizationKey="%SideQuestLore#0015-Step3Reward"/>
      </Step>
    </Steps>

  </QuestDefinition>

  <!-- ============ A Fragment of Crystal / Haunts ============-->
  <QuestDefinition Name="SideQuestLore#0016" Category="SideQuest" SubCategory="Minor"
                   Cooldown="5" SkipLockedQuestTarget="true" NumberOfConcurrentInstances="1" NumberOfOccurencesPerEmpire="1" NumberOfOccurencesPerGame="0">

    <!--============ TAGS ============-->
    <Tags>Interact</Tags>

    <!--============ PREREQUISITES ============-->
    <Prerequisites Target="$(Empire)">
      <DownloadableContentPrerequisite Flags="Prerequisite">LoreQuestsPack</DownloadableContentPrerequisite>
      <PathPrerequisite Flags="Prerequisite">../EmpireTypeMajor/ClassResearch,TechnologyEra3</PathPrerequisite>
      <PathPrerequisite Inverted="true" Flags="Prerequisite">EmpireTypeMajor,FactionTraitReplicants1</PathPrerequisite>
      <QuestStatePrerequisite Inverted="true" QuestDefinitionName="SideQuestNavalInteract#0012" QuestState="InProgress"/>
      <QuestStatePrerequisite Inverted="true" QuestDefinitionName="SideQuestNavalInteract#0012" QuestState="Unstarted"/>
    </Prerequisites>

    <!--============ VARIABLES ============-->
    <Vars>
      <Var VarName="$InitialRuin">
        <From Source="$TargetPointsOfInterest"/>
      </Var>

      <!--Actual level of Science Empire Plan-->
      <InterpretedVar VarName="CurrentScienceEmpirePlan" Target="$(Empire)">
        <Expression>$Property(EmpireTypeMajor:EmpirePlanKnowledgeLevel)</Expression>
      </InterpretedVar>

      <!--Science Empire Plan objective-->
      <InterpretedVar VarName="ScienceEmpirePlanObjective" Target="$(Empire)">
        <Expression>$(CurrentScienceEmpirePlan) + 1</Expression>
      </InterpretedVar>

      <LocalizationVar LocalizationKey="$ScienceEmpirePlanObjective" Source="ScienceEmpirePlanObjective"/>

    </Vars>

    <!--============ SEQUENCE ============-->

    <Controller_Sequence>
      <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="InProgress"/>

      <Controller_Parallel CompletionPolicy="Any">

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience0</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience8</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience3</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience0</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience8</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience1</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience0</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience8</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience2</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience0</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience3</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience1</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience0</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience3</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience2</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience8</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience3</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience1</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience8</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience3</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience2</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience3</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience1</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience2</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience0</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience1</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience2</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience0</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience1</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience4</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience0</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience1</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience5</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience0</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience1</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience6</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience0</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience2</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience4</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience0</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience2</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience5</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience0</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience2</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience6</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience0</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience3</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience4</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience0</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience3</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience5</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience0</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience3</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience6</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience0</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience4</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience5</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience0</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience4</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience6</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience0</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience4</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience8</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience0</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience5</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience6</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience0</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience5</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience8</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience0</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience6</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience8</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience1</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience2</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience4</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience1</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience2</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience5</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience1</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience2</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience6</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience1</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience2</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience8</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience1</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience3</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience4</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience1</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience3</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience5</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience1</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience3</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience6</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience1</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience4</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience5</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience1</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience4</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience6</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience1</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience4</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience8</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience1</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience5</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience6</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience1</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience5</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience8</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience1</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience6</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience8</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience2</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience3</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience4</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience2</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience3</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience5</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience2</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience3</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience6</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience2</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience4</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience5</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience2</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience4</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience6</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience2</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience4</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience8</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience2</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience5</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience6</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience2</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience5</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience8</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience2</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience6</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience8</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience3</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience4</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience5</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience3</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience4</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience6</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience3</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience4</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience8</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience3</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience5</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience6</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience3</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience5</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience8</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience3</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience6</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience8</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience4</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience5</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience6</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience4</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience5</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience8</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite >
              <Prerequisites Target="$Empire">
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience5</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience6</PathPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassResearch, TechnologyScience8</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
          <Action_UpdateStep StepName="SideQuestLore#0016-Step1" State="Completed"/>
        </Controller_Sequence>

      </Controller_Parallel>

      <!--Step 2-->
      <Controller_Sequence>
        <Action_UpdateStep StepName="SideQuestLore#0016-Step2" State="InProgress" />
        <!--Obtain the 2nd Level of the Science EmpirePlan-->
        <!--<Action_UpdateStep StepName="SideQuestLore#0016-Step2" State="InProgress"/>
            <Decorator_BeginTurn Initiator="Empire">
                <ConditionCheck_Prerequisite>
                    <Prerequisites Target="$Empire">
                        <PathPrerequisite Flags="Prerequisite">EmpireTypeMajor/ClassEmpirePlan,EmpirePlanKnowledge2</PathPrerequisite>
                    </Prerequisites>
                </ConditionCheck_Prerequisite>
            </Decorator_BeginTurn>-->

        <Decorator_BeginTurn Initiator="Empire" >
          <InterpretedVarsToUpdate>
            <Var>CurrentScienceEmpirePlan</Var>
          </InterpretedVarsToUpdate>
          <ConditionCheck_IsStepProgressionComplete InterpretedValue="$(CurrentScienceEmpirePlan)" StepName="SideQuestLore#0016-Step2" />
        </Decorator_BeginTurn>
        <Action_UpdateStep StepName="SideQuestLore#0016-Step2" State="Completed" />
        <Action_UpdateQuest State="Completed"/>

      </Controller_Sequence>
    </Controller_Sequence>

    <!--============ REWARDS ============-->
    <Steps>
      <Step Name="SideQuestLore#0016-Step1">
        <Reward Droplist="DroplistMadFairiesMainQuestRewards" Picks="1"/>
      </Step>
      <Step Name="SideQuestLore#0016-Step2">
        <ProgressionRange StartValue="0" EndValueVarName="ScienceEmpirePlanObjective"/>
        <Reward Droplist="DroplistDust" Picks="1"/>
      </Step>
    </Steps>

  </QuestDefinition>

  <!-- ============ The Land of Godheads / Erycis ============-->
  <QuestDefinition Name="SideQuestLore#0017" Category="SideQuest" SubCategory="Minor"
                     Cooldown="0" SkipLockedQuestTarget="true" NumberOfConcurrentInstances="8" NumberOfOccurencesPerEmpire="1" NumberOfOccurencesPerGame="0">

    <!--============ TAGS ============-->
    <Tags>BeginTurn</Tags>

    <!--============ PREREQUISITES ============-->

    <Prerequisites Target="$(Empire)">
      <DownloadableContentPrerequisite Flags="Prerequisite">LoreQuestsPack</DownloadableContentPrerequisite>
      <PathPrerequisite Inverted="true" Flags="Prerequisite">../EmpireTypeMajor,AffinityCultists</PathPrerequisite>
      <PathPrerequisite Flags="Prerequisite">../EmpireTypeMajor/AffinityErycis</PathPrerequisite>
      <InterpreterPrerequisite Flags="Prerequisite">$Count(EmpireTypeMajor/ClassCity/ClassDistrict,TerrainTagPlains) ge 1</InterpreterPrerequisite>
      <InterpreterPrerequisite Flags="Prerequisite">$Count(EmpireTypeMajor/ClassCity/ClassDistrict,TerrainTagRocks) ge 1</InterpreterPrerequisite>
      <InterpreterPrerequisite Flags="Prerequisite">$Count(EmpireTypeMajor/ClassCity/ClassDistrict,TerrainTagForest) ge 1</InterpreterPrerequisite>
      <InterpreterPrerequisite Flags="Prerequisite">$Count(EmpireTypeMajor/ClassCity/ClassDistrict,TerrainTagArid) ge 1</InterpreterPrerequisite>
    </Prerequisites>

    <!--============ VARIABLES ============-->

    <Vars>

      <!--Current Plains exploited-->
      <InterpretedVar VarName="CurrentPlainsExploited" Target="$(Empire)">
        <Expression>$Count(EmpireTypeMajor/ClassCity/ClassDistrict,TerrainTagPlains)</Expression>
      </InterpretedVar>

      <!--Plains exploited objective-->
      <InterpretedVar VarName="PlainsExploitedObjective" Target="$(Empire)">
        <Expression>$(CurrentPlainsExploited) + 2</Expression>
      </InterpretedVar>

      <!--Current Rocks exploited-->
      <InterpretedVar VarName="CurrentRocksExploited" Target="$(Empire)">
        <Expression>$Count(EmpireTypeMajor/ClassCity/ClassDistrict,TerrainTagRocks)</Expression>
      </InterpretedVar>

      <!--Rocks exploited objective-->
      <InterpretedVar VarName="RocksExploitedObjective" Target="$(Empire)">
        <Expression>$(CurrentRocksExploited) + 2</Expression>
      </InterpretedVar>

      <!--Current Forest exploited-->
      <InterpretedVar VarName="CurrentForestExploited" Target="$(Empire)">
        <Expression>$Count(EmpireTypeMajor/ClassCity/ClassDistrict,TerrainTagForest)</Expression>
      </InterpretedVar>

      <!--Forest exploited objective-->
      <InterpretedVar VarName="ForestExploitedObjective" Target="$(Empire)">
        <Expression>$(CurrentForestExploited) + 2</Expression>
      </InterpretedVar>

      <!--Current Arid exploited-->
      <InterpretedVar VarName="CurrentAridExploited" Target="$(Empire)">
        <Expression>$Count(EmpireTypeMajor/ClassCity/ClassDistrict,TerrainTagArid)</Expression>
      </InterpretedVar>

      <!--Arid exploited objective-->
      <InterpretedVar VarName="AridExploitedObjective" Target="$(Empire)">
        <Expression>$(CurrentAridExploited) + 2</Expression>
      </InterpretedVar>

      <!--Targets my Empire-->
      <Var VarName="$MyEmpire">
        <From Source="$Empire"/>
      </Var>

      <!--My Empire Regions-->
      <Var VarName="$EmpireRegions">
        <From Source="$Regions">
          <Where>
            <FilterRegionByEmpire EmpireVarName="$MyEmpire"/>
            <FilterRegionIsContinent/>
          </Where>
        </From>
      </Var>

      <!--Check that at least 1 region has at least 1 Erycis village-->
      <Var VarName="$EmpireRegionsErycisMinorEmpire">
        <Any>
          <From Source="$EmpireRegions.$MinorEmpire">
            <Where>
              <PathPrerequisite Flags="Prerequisite">AffinityErycis</PathPrerequisite>
            </Where>
          </From>
        </Any>
      </Var>

      <!--Set the Erycis village for spawn-->
      <Var VarName="$ErycisVillage">
        <Any>
          <From Source="$EmpireRegionsErycisMinorEmpire.$Villages">
            <Where>
              <PathPrerequisite Flags="Prerequisite">PacifiedVillage</PathPrerequisite>
            </Where>
          </From>
        </Any>
      </Var>

      <!--Set the Erycis village for spawn-->
      <Var VarName="$ErycisVillagePOILocation">
        <From Source="$ErycisVillage.$PointOfInterest.$Position"/>
      </Var>

    </Vars>

    <!--============ SEQUENCE ============-->
    <Controller_Sequence>
      <Action_UpdateStep StepName="SideQuestLore#0017-Step1" State="InProgress" />

      <Controller_Parallel CompletionPolicy="Any">

      <Controller_Sequence>
        <Controller_Parallel CompletionPolicy="All">

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire" LinkedStepProgression="SideQuestLore#0017-Step1">
            <InterpretedVarsToUpdate>
              <Var>CurrentPlainsExploited</Var>
            </InterpretedVarsToUpdate>
            <ConditionCheck_Prerequisite>
              <Prerequisites Target="$Empire">
                <InterpreterPrerequisite Flags="Prerequisite">$(CurrentPlainsExploited) ge $(PlainsExploitedObjective)</InterpreterPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire" LinkedStepProgression="SideQuestLore#0017-Step1">
            <InterpretedVarsToUpdate>
              <Var>CurrentRocksExploited</Var>
            </InterpretedVarsToUpdate>
            <ConditionCheck_Prerequisite>
              <Prerequisites Target="$Empire">
                <InterpreterPrerequisite Flags="Prerequisite">$(CurrentRocksExploited) ge $(RocksExploitedObjective)</InterpreterPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire" LinkedStepProgression="SideQuestLore#0017-Step1">
            <InterpretedVarsToUpdate>
              <Var>CurrentForestExploited</Var>
            </InterpretedVarsToUpdate>
            <ConditionCheck_Prerequisite>
              <Prerequisites Target="$Empire">
                <InterpreterPrerequisite Flags="Prerequisite">$(CurrentForestExploited) ge $(ForestExploitedObjective)</InterpreterPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire" LinkedStepProgression="SideQuestLore#0017-Step1">
            <InterpretedVarsToUpdate>
              <Var>CurrentAridExploited</Var>
            </InterpretedVarsToUpdate>
            <ConditionCheck_Prerequisite>
              <Prerequisites Target="$Empire">
                <InterpreterPrerequisite Flags="Prerequisite">$(CurrentAridExploited) ge $(AridExploitedObjective)</InterpreterPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>
        </Controller_Sequence>

      </Controller_Parallel>

        <Action_SpawnArmy SpawnLocationVarName="$ErycisVillagePOILocation" ArmyDroplist="DroplistArmyDefinitionLoreQuest0017EndRewardELCP" ScaleWithMaxEra="true" EmpireArmyOwnerVarName="$MyEmpire"/>
        <!--Make a Erycis Units spawn on initial village-->
        <Action_UpdateStep StepName="SideQuestLore#0017-Step1" State="Completed" />
        <Action_UpdateQuest State="Completed"/>
        </Controller_Sequence>

        <!--Step 1 - Fail Condition 1 - Faction no longer assimilated-->
        <Controller_Sequence>
          <Decorator_BeginTurn Initiator="Empire">
            <ConditionCheck_Prerequisite>
              <Prerequisites Target="$Empire">
                <PathPrerequisite Inverted="true" Flags="Prerequisite">../EmpireTypeMajor/AffinityErycis</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_BeginTurn>

          <Action_UpdateQuest State="Failed"/>
        </Controller_Sequence>

      </Controller_Parallel>

    </Controller_Sequence>


    <!--============ REWARDS ============-->
    <Steps>
      <Step Name="SideQuestLore#0017-Step1">
        <ProgressionRange StartValue="0" EndValue="4"/>
        <Reward Droplist="DroplistGlobalQuestDust" Picks="1"/>
        <Reward LocalizationKey="%SideQuestLore#0017-Step1Reward"/>
      </Step>
    </Steps>

  </QuestDefinition>

  <!-- ============ Relocation of the Blind / Eyeless Ones ============-->
  <QuestDefinition Name="SideQuestLore#0018" Category="SideQuest" SubCategory="Minor"
                   Cooldown="1" SkipLockedQuestTarget="true" NumberOfConcurrentInstances="1" NumberOfOccurencesPerEmpire="1" NumberOfOccurencesPerGame="0">

    <!--============ TAGS ============-->
    <Tags>Interact</Tags>

    <!--============ PREREQUISITES ============-->
    <Prerequisites Target="$(Empire)">
      <DownloadableContentPrerequisite Flags="Prerequisite">LoreQuestsPack</DownloadableContentPrerequisite>
      <PathPrerequisite Flags="Prerequisite">../EmpireTypeMajor/ClassResearch,TechnologyEra2</PathPrerequisite>
    </Prerequisites>

    <!--============ VARIABLES ============-->
    <Vars>
      <Var VarName="$InitialRuin">
        <From Source="$TargetPointsOfInterest"/>
      </Var>

      <Var VarName="$InitialRuinLocation">
        <From Source="$TargetPointsOfInterest.$Position"/>
      </Var>

      <Var VarName="$InitialRuinRegion">
        <From Source="$InitialRuinLocation.$Region"/>
      </Var>
    </Vars>

    <!--============ SEQUENCE ============-->

    <Controller_Sequence>
      <Action_UpdateStep StepName="SideQuestLore#0018-Step1" State="InProgress"/>
      <Controller_Parallel CompletionPolicy="Any">

        <Controller_Sequence>
          <Decorator_ConstructionEnded ConstructionName="CityImprovementEmpirePoint1" Initiator="Empire"/>
          <Action_UpdateStep StepName="SideQuestLore#0018-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_ConstructionEnded ConstructionName="CityImprovementEmpirePoint2" Initiator="Empire"/>
          <Action_UpdateStep StepName="SideQuestLore#0018-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_ConstructionEnded ConstructionName="CityImprovementEmpirePoint5" Initiator="Empire"/>
          <Action_UpdateStep StepName="SideQuestLore#0018-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_ConstructionEnded ConstructionName="CityImprovementEmpirePoint3" Initiator="Empire"/>
          <Action_UpdateStep StepName="SideQuestLore#0018-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_ConstructionEnded ConstructionName="CityImprovementEmpirePoint4" Initiator="Empire"/>
          <Action_UpdateStep StepName="SideQuestLore#0018-Step1" State="Completed"/>
        </Controller_Sequence>

        <Controller_Sequence>
          <Decorator_ConstructionEnded ConstructionName="CityImprovementEmpirePoint6" Initiator="Empire"/>
          <Action_UpdateStep StepName="SideQuestLore#0018-Step1" State="Completed"/>
        </Controller_Sequence>

      </Controller_Parallel>

      <Controller_Sequence>
        <Action_AddQuestMarker TargetEntityVarName="$InitialRuin" Tags="Ruin" RevealUnexploredLand="false" MarkerVisibleInFogOfWar="true" Output_QuestMarkerVarName="$QuestMarkerInitialRuin"/>

        <Action_UpdateStep StepName="SideQuestLore#0018-Step2" State="InProgress"/>
        <Decorator_Inspect TargetEntityVarName="$InitialRuin" Initiator="Empire"/>
        <Action_UpdateStep StepName="SideQuestLore#0018-Step2" State="Completed"/>
        <Action_UpdateQuest State="Completed"/>

      </Controller_Sequence>
      <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerInitialRuin"/>
    </Controller_Sequence>

    <!--============ REWARDS ============-->
    <Steps>
      <Step Name="SideQuestLore#0018-Step1">
        <Reward Droplist="DroplistMadFairiesMainQuestRewards" Picks="1"/>
      </Step>
      <Step Name="SideQuestLore#0018-Step2">
        <Reward Droplist="DroplistMadFairiesMainQuestRewards" Picks="1"/>
      </Step>
    </Steps>

  </QuestDefinition>

  <!-- ============ Running with the Hunt / Hurnas ============-->
  <QuestDefinition Name="SideQuestLore#0019" Category="SideQuest" SubCategory="Minor"
                      Cooldown="10" SkipLockedQuestTarget="true" NumberOfConcurrentInstances="1" NumberOfOccurencesPerEmpire="2" NumberOfOccurencesPerGame="0">

    <!--============ TAGS ============-->
    <Tags>Talk</Tags>

    <!--Prerequisite-->
    <Prerequisites Target="$(Empire)">
      <DownloadableContentPrerequisite Flags="Prerequisite">LoreQuestsPack</DownloadableContentPrerequisite>
      <PathPrerequisite Inverted="true" Flags="Prerequisite">../EmpireTypeMajor/AffinityHurnas</PathPrerequisite>
      <InterpreterPrerequisite Flags="Prerequisite">$Property(ClassEmpire:CurrentTurn) ge (2 * $Property(ClassEmpire:GameSpeedMultiplier))</InterpreterPrerequisite>
    </Prerequisites>

    <!--============ VARIABLES============-->
    <Vars>

      <Var VarName="$MyEmpire">
        <From Source="$Empire"/>
      </Var>

      <!--Check the number of pacified villages as prerequisite-->
      <Var VarName="$InitialTribeRegion">
        <From Source="$TargetVillage.$PointOfInterest.$Position.$Region"/>
      </Var>

      <Var VarName="$StateOfMinorEmpire">
        <From Source="$InitialTribeRegion.$MinorEmpire">
          <Where>
            <InterpreterPrerequisite Flags="Prerequisite">$Count(ClassEmpire/MinorEmpireVillage,!PacifiedVillage) ge 2</InterpreterPrerequisite>
            <InterpreterPrerequisite Flags="Prerequisite">$Count(ClassEmpire/MinorEmpireVillage,!ConvertedVillage) ge 2</InterpreterPrerequisite>
          </Where>
        </From>
      </Var>
      <!--Villages States-->
      <Var VarName="$InitialVillagesPointOfInterests">
        <From Source="$InitialTribeRegion.$Villages.$PointOfInterest"/>
      </Var>

      <Var VarName="$InitialVillage">
        <From Source="$TargetVillage">
          <Where>
            <PathPrerequisite Inverted="true" Flags="Prerequisite">PacifiedVillage</PathPrerequisite>
            <PathPrerequisite Inverted="true" Flags="Prerequisite">ConvertedVillage</PathPrerequisite>
          </Where>
        </From>
      </Var>
      <!--Select only the Hurnas-->
      <Var VarName="$Tribe">
        <From Source="$InitialVillage.$MinorEmpire">
          <Where>
            <PathPrerequisite Flags="Prerequisite">AffinityHurnas</PathPrerequisite>
          </Where>
        </From>
      </Var>

      <Var VarName="$InitialVillagePointOfInterest">
        <From Source="$TargetPointsOfInterest"/>
      </Var>

      <Var VarName="$InitialVillagePointOfInterestLocation">
        <From Source="$TargetPointsOfInterest.$Position"/>
      </Var>

      <LocalizationVar LocalizationKey="$MinorFaction" Source="$Tribe"/>
      <LocalizationVar LocalizationKey="$InitialTribeRegionName" Source="$InitialTribeRegion"/>

    </Vars>

    <!--============ SEQUENCE ============-->

    <Controller_Sequence>
      <Action_UpdateStep StepName="SideQuestLore#0019-Step1" State="InProgress" />
      <Action_LockInteraction TargetVarName="$InitialVillagesPointOfInterests" InteractionName="ArmyActionParley" InteractionLockOption="Lock"/>
      <Action_LockInteraction TargetVarName="$InitialVillagePointOfInterest" InteractionName="ArmyActionParley" InteractionLockOption="Unlock"/>
      <Action_LockQuestTarget TargetVarName="$InitialVillagePointOfInterest" LockOption="Lock"/>

      <!--Step 1 - Give 2 Units-->
      <Controller_Parallel CompletionPolicy="Any">
        <Controller_Sequence>
          <Action_AddQuestMarker TargetEntityVarName="$InitialVillagePointOfInterest" Tags="Village" RevealUnexploredLand="false" MarkerVisibleInFogOfWar="false" Output_QuestMarkerVarName="$QuestMarkerInitialVillagePointOfInterest"/>
          <Decorator_Talk TargetEntityVarName="$InitialVillagePointOfInterest" Output_InstigatorSimObjectVarName="$InspectionInstigatorSimObject" Output_InstigatorGUIDVarName="$InspectionInstigatorGUID" PrerequisiteNotVerifiedMessage="%QuestPrerequisiteNotVerified" Initiator="Empire">
            <ConditionCheck_Prerequisite>
              <Prerequisites Target="$InspectionInstigatorSimObject">
                <InterpreterPrerequisite Flags="Prerequisite">$Count(ClassArmy/ClassUnit) eq 2 </InterpreterPrerequisite>
                <PathPrerequisite Flags="Prerequisite">ClassArmy/ClassUnit</PathPrerequisite>
              </Prerequisites>
            </ConditionCheck_Prerequisite>
          </Decorator_Talk>

          <Action_DestroyArmy ArmyGUIDVarName="$InspectionInstigatorGUID" />

          <!--Step 2 - Just Wait...-->
          <Action_UpdateStep StepName="SideQuestLore#0019-Step1" State="Completed" />
          <Action_UpdateStep StepName="SideQuestLore#0019-Step2" State="InProgress" />
          <Action_StartTimer Output_TimerVarName="$TimeBeforeReset"/>
          <Controller_Parallel CompletionPolicy="Any">
            <Controller_Sequence>
              <Decorator_Talk TargetEntityVarName="$InitialVillagePointOfInterest" PrerequisiteNotVerifiedMessage="%QuestPrerequisiteNotVerified" Initiator="Empire">
                <ConditionCheck_Prerequisite>
                  <Prerequisites Target="$Empire">
                    <InterpreterPrerequisite Flags="Prerequisite">$Property(ClassEmpire:CurrentTurn) ge 9999</InterpreterPrerequisite>
                  </Prerequisites>
                </ConditionCheck_Prerequisite>
              </Decorator_Talk>
            </Controller_Sequence>
            <Controller_Sequence>
              <Action_UpdateTimerLocalization TurnCountBeforeTimeOut="10" TimerLocalizationKey="$Timer" TimerVarName="$TimeBeforeReset"/>
              <Decorator_TimerEnded TimerVarName="$TimeBeforeReset" TurnCountBeforeTimeOut="10" TimerLocalizationKey="$Timer" Initiator="Empire"/>
            </Controller_Sequence>
          </Controller_Parallel>
          <Action_UpdateStep StepName="SideQuestLore#0019-Step2" State="Completed" />

          <!--Step 3 - Pacify and give back units-->
          <Action_UpdateStep StepName="SideQuestLore#0019-Step3" State="InProgress" />
          <Decorator_Talk TargetEntityVarName="$InitialVillagePointOfInterest" PrerequisiteNotVerifiedMessage="%QuestPrerequisiteNotVerified" Initiator="Empire"/>
          <Action_SpawnArmy SpawnLocationVarName="$InitialVillagePointOfInterestLocation" ArmyDroplist="DroplistArmyDefinitionLoreQuest0019EndReward" ForbiddenSpawnLocationVarName="$ForbiddenSpawnLocation" EmpireArmyOwnerVarName="$MyEmpire"/>

          <Action_PacifyMinorFaction TargetEmpireVarName="$Tribe"/>
          <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerInitialVillagePointOfInterest"/>
          <Action_UpdateStep StepName="SideQuestLore#0019-Step3" State="Completed" />
          <Action_UpdateQuest State="Completed" />
        </Controller_Sequence>

        <!--Fail Condition 1 - Village is destroyed-->
        <Controller_Sequence>
          <Decorator_VillagesDestroyed VillagesVarName="$InitialVillage" Initiator="AllEmpires"/>
          <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerInitialVillagePointOfInterest" />
          <Action_LockQuestTarget TargetVarName="$InitialVillagePointOfInterest" LockOption="Unlock"/>
          <Action_UpdateQuest State="Failed"/>
        </Controller_Sequence>

        <!--Fail Condition 2 - Village is pacified-->
        <Controller_Sequence>
          <Decorator_VillagesPacified VillagesVarName="$InitialVillage" TargetOption="All" Initiator="AllEmpires"/>
          <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerInitialVillagePointOfInterest" />
          <Action_LockQuestTarget TargetVarName="$InitialVillagePointOfInterest" LockOption="Unlock"/>
          <Action_UpdateQuest State="Failed"/>
        </Controller_Sequence>

      </Controller_Parallel>

      <Action_LockInteraction TargetVarName="$InitialVillagesPointOfInterests" InteractionName="ArmyActionParley" InteractionLockOption="Unlock"/>

    </Controller_Sequence>

    <!--============ REWARDS ============-->
    <Steps>
      <Step Name="SideQuestLore#0019-Step1">
        <Reward Droplist="DroplistMadFairiesMainQuestRewards" Picks="1"/>
      </Step>
      <Step Name="SideQuestLore#0019-Step2">
        <Reward Droplist="DroplistMadFairiesMainQuestRewards" Picks="1"/>
      </Step>
      <Step Name="SideQuestLore#0019-Step3">
        <Reward LocalizationKey="%Pacification"/>
        <Reward LocalizationKey="%SideQuestLore#0019-Step3Reward"/>
      </Step>
    </Steps>

  </QuestDefinition>

  <!-- ============ Marathon / Bos ============-->
  <QuestDefinition Name="SideQuestLore#0020" Category="SideQuest" SubCategory="Minor"
                     Cooldown="7" SkipLockedQuestTarget="true" NumberOfConcurrentInstances="1" NumberOfOccurencesPerEmpire="1" NumberOfOccurencesPerGame="0">

    <!--============ TAGS ============-->
    <Tags>Talk</Tags>

    <!--Prerequisite-->
    <Prerequisites Target="$(Empire)">
      <DownloadableContentPrerequisite Flags="Prerequisite">LoreQuestsPack</DownloadableContentPrerequisite>
    </Prerequisites>

    <!--============ VARIABLES============-->

    <Vars>

      <!--Targets my Empire-->
      <Var VarName="$MyEmpire">
        <From Source="$Empire"/>
      </Var>
      <!--Check the number of pacified villages as prerequisite-->
      <Var VarName="$InitialTribeRegion">
        <From Source="$TargetVillage.$PointOfInterest.$Position.$Region"/>
      </Var>

      <!--Select only the Bos and more than 2 villages in region-->
      <Var VarName="$Tribe">
        <From Source="$TargetVillage.$MinorEmpire">
          <Where>
            <PathPrerequisite Flags="Prerequisite">AffinityBos</PathPrerequisite>
          </Where>
        </From>
      </Var>
      <Var VarName="$InitialTribeEmpire">
        <From Source="$InitialTribeRegion.$MinorEmpire">
          <Where>
            <InterpreterPrerequisite Flags="Prerequisite">$Count(ClassEmpire/MinorEmpireVillage,!PacifiedVillage) ge 2</InterpreterPrerequisite>
            <InterpreterPrerequisite Flags="Prerequisite">$Count(ClassEmpire/MinorEmpireVillage,!ConvertedVillage) ge 2</InterpreterPrerequisite>
          </Where>
        </From>
      </Var>

      <!--Quest will not trigger if there is no land region nearby-->
      <Var VarName="$ContinentNearbyRegions">
        <Any>
          <From Source="$InitialTribeRegion.$NeighbourRegions">
            <Where>
              <FilterRegionIsOnSameContinent RegionContextVarName="$InitialTribeRegion"/>
            </Where>
          </From>
        </Any>
      </Var>

      <Var VarName="$InitialVillage">
        <From Source="$TargetVillage">
          <Where>
            <PathPrerequisite Inverted="true" Flags="Prerequisite">PacifiedVillage</PathPrerequisite>
            <PathPrerequisite Inverted="true" Flags="Prerequisite">ConvertedVillage</PathPrerequisite>
          </Where>
        </From>
      </Var>

      <!--Get the location of the village the Player talk to-->
      <Var VarName="$InitialVillagePointOfInterest">
        <From Source="$TargetPointsOfInterest"/>
      </Var>

      <!--Get the location of the village the Player talk to-->
      <Var VarName="$InitialVillageLocation">
        <From Source="$TargetPointsOfInterest.$Position"/>
      </Var>

      <!--Get the position of the village region-->
      <Var VarName="$InitialVillageRegionLocation">
        <From Source="$InitialTribeRegion.$Position.$Region"/>
      </Var>


      <!--Get the list of all the nearest regions excluding the initial village region-->
      <Var VarName="$AllRegionsNearbyButInitialVillageRegion">
        <From Source="$Regions">
          <Where>
            <FilterRegionIsOnSameContinent RegionContextVarName="$InitialTribeRegion"/>
            <FilterRegionByDistance PositionToCompareVarName="$InitialVillageLocation" DistanceMin="1"/>
          </Where>
        </From>
      </Var>

      <!--Get the 1st Village POI to inspect-->
      <Var VarName="$1stQuestVillagesToInspect">
        <Limit LimitMin="1" LimitMax="2" Clamp="false">
          <From Source="$AllRegionsNearbyButInitialVillageRegion.$Villages"/>
        </Limit>
      </Var>

	  <Var VarName="$QuestVillageToInspect1">
        <Any>
          <From Source="$1stQuestVillagesToInspect"/>
        </Any>
      </Var>

	  <Var VarName="$QuestPOIToInspect1">
        <Any>
          <From Source="$1stQuestVillagesToInspect.$PointOfInterest"/>
        </Any>
      </Var>

      <!--Get the 2nd Village POI to inspect-->
      <Var VarName="$2ndQuestVillagesToInspect">
        <Limit LimitMin="2" LimitMax="3" Clamp="false">
          <From Source="$AllRegionsNearbyButInitialVillageRegion.$Villages"/>
        </Limit>
      </Var>

      <Var VarName="$QuestVillageToInspect2">
        <Any>
          <From Source="$2ndQuestVillagesToInspect"/>
        </Any>
      </Var>

	  <Var VarName="$QuestPOIToInspect2">
        <Any>
          <From Source="$2ndQuestVillagesToInspect.$PointOfInterest"/>
        </Any>
      </Var>

      <!--Get the 3rd Village POI to inspect-->
      <Var VarName="$3rdQuestVillagesToInspect">
        <Limit LimitMin="3" LimitMax="4" Clamp="false">
          <From Source="$AllRegionsNearbyButInitialVillageRegion.$Villages"/>
        </Limit>
      </Var>

	  <Var VarName="$QuestVillageToInspect3">
        <Any>
          <From Source="$3rdQuestVillagesToInspect"/>
        </Any>
      </Var>

      <Var VarName="$QuestPOIToInspect3">
        <Any>
          <From Source="$3rdQuestVillagesToInspect.$PointOfInterest"/>
        </Any>
      </Var>

      <LocalizationVar LocalizationKey="$MinorFaction" Source="$Tribe"/>
      <LocalizationVar LocalizationKey="$InitialTribeRegionName" Source="$InitialTribeRegion"/>

    </Vars>

    <!--============ SEQUENCE ============-->

    <Controller_Sequence>

      <Controller_Parallel CompletionPolicy="Any">

        <Controller_Sequence>

		  <!-- Step 1-->
		  <Action_LockQuestTarget TargetVarName="$QuestPOIToInspect1" LockOption="Lock"/>
		  <Action_LockQuestTarget TargetVarName="$QuestPOIToInspect2" LockOption="Lock"/>
		  <Action_LockQuestTarget TargetVarName="$QuestPOIToInspect3" LockOption="Lock"/>
		  <Action_LockQuestTarget TargetVarName="$InitialVillagePointOfInterest" LockOption="Lock"/>
		  <Action_AddQuestMarker TargetEntityVarName="$QuestPOIToInspect1" Tags="Village" RevealUnexploredLand="true" MarkerVisibleInFogOfWar="true" Output_QuestMarkerVarName="$QuestMarkerQuestPOIToInspect1"/>
		  <Action_AddQuestMarker TargetEntityVarName="$QuestPOIToInspect2" Tags="Village" RevealUnexploredLand="true" MarkerVisibleInFogOfWar="true" Output_QuestMarkerVarName="$QuestMarkerQuestPOIToInspect2"/>
		  <Action_AddQuestMarker TargetEntityVarName="$QuestPOIToInspect3" Tags="Village" RevealUnexploredLand="true" MarkerVisibleInFogOfWar="true" Output_QuestMarkerVarName="$QuestMarkerQuestPOIToInspect3"/>
		  <Action_SpawnArmy SpawnLocationVarName="$InitialVillageLocation" ArmyDroplist="DroplistArmyDefinitionLoreQuest0020InitialReward" EmpireArmyOwnerVarName="$MyEmpire"/>
		  <Action_UpdateStep StepName="SideQuestLore#0020-Step1" State="InProgress"/>
		  <Action_StartTimer Output_TimerVarName="$TimeBeforeFailure"/>
		  <Action_UpdateTimerLocalization TurnCountBeforeTimeOut="20" TimerLocalizationKey="$Timer" TimerVarName="$TimeBeforeFailure"/>

		  <Controller_Parallel CompletionPolicy="All">
			<Controller_Sequence>
			  <Decorator_Talk TargetEntityVarName="$QuestPOIToInspect1" Output_InstigatorSimObjectVarName="$InspectionInstigatorSimObject" Initiator="Empire" PrerequisiteNotVerifiedMessage="%QuestPrerequisiteNotVerified" LinkedStepProgression="SideQuestLore#0020-Step1">
				<ConditionCheck_Prerequisite>
				  <Prerequisites Target="$InspectionInstigatorSimObject">
					<PathPrerequisite Flags="Prerequisite">ClassArmy/ClassUnit,UnitTypeBosCentaur</PathPrerequisite><!--At least 1 Bos talking to village-->
				  </Prerequisites>
				</ConditionCheck_Prerequisite>
			  </Decorator_Talk>
			  <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerQuestPOIToInspect1"/>
			</Controller_Sequence>
			<Controller_Sequence>
			  <Decorator_Talk TargetEntityVarName="$QuestPOIToInspect2" Output_InstigatorSimObjectVarName="$InspectionInstigatorSimObject" Initiator="Empire" PrerequisiteNotVerifiedMessage="%QuestPrerequisiteNotVerified" LinkedStepProgression="SideQuestLore#0020-Step1">
				<ConditionCheck_Prerequisite>
				  <Prerequisites Target="$InspectionInstigatorSimObject">
					<PathPrerequisite Flags="Prerequisite">ClassArmy/ClassUnit,UnitTypeBosCentaur</PathPrerequisite>
				  </Prerequisites>
				</ConditionCheck_Prerequisite>
			  </Decorator_Talk>
			  <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerQuestPOIToInspect2"/>
			</Controller_Sequence>
			<Controller_Sequence>
			  <Decorator_Talk TargetEntityVarName="$QuestPOIToInspect3" Output_InstigatorSimObjectVarName="$InspectionInstigatorSimObject" Initiator="Empire" PrerequisiteNotVerifiedMessage="%QuestPrerequisiteNotVerified" LinkedStepProgression="SideQuestLore#0020-Step1">
				<ConditionCheck_Prerequisite>
				  <Prerequisites Target="$InspectionInstigatorSimObject">
					<PathPrerequisite Flags="Prerequisite">ClassArmy/ClassUnit,UnitTypeBosCentaur</PathPrerequisite>
				  </Prerequisites>
				</ConditionCheck_Prerequisite>
			  </Decorator_Talk>
			  <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerQuestPOIToInspect3"/>
			</Controller_Sequence>
		  </Controller_Parallel>

		  <!--Step 2-->
		  <Action_LockQuestTarget TargetVarName="$InitialVillagePointOfInterest" LockOption="Unlock"/>
		  <Action_UpdateStep StepName="SideQuestLore#0020-Step1" State="Completed"/>
		  <Action_UpdateStep StepName="SideQuestLore#0020-Step2" State="InProgress"/>
		  <Action_AddQuestMarker TargetEntityVarName="$InitialVillagePointOfInterest" Tags="Village" RevealUnexploredLand="true" MarkerVisibleInFogOfWar="true" Output_QuestMarkerVarName="$QuestMarkerInitialVillagePointOfInterest"/>
		  <Decorator_Talk TargetEntityVarName="$InitialVillagePointOfInterest" Initiator="Empire"/>
		  <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerInitialVillagePointOfInterest"/>
		  <Action_LockQuestTarget TargetVarName="$QuestPOIToInspect1" LockOption="Unlock"/>
		  <Action_LockQuestTarget TargetVarName="$QuestPOIToInspect2" LockOption="Unlock"/>
		  <Action_LockQuestTarget TargetVarName="$QuestPOIToInspect3" LockOption="Unlock"/>
		  <Action_LockQuestTarget TargetVarName="$InitialVillagePointOfInterest" LockOption="Unlock"/>
		  <Action_PacifyMinorFaction TargetEmpireVarName="$Tribe"/>
		  <Action_UpdateStep StepName="SideQuestLore#0020-Step2" State="Completed"/>
		  <Action_UpdateQuest State="Completed"/>

        </Controller_Sequence>

		<!--  FAIL CONDITIONS  -->

		<!--Step 1 - Fail Condition - Timer is out-->
		<Controller_Sequence>
		  <Decorator_TimerEnded TimerVarName="$TimeBeforeFailure" TurnCountBeforeTimeOut="20" TimerLocalizationKey="$Timer" Initiator="Empire"/>
		  <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerQuestPOIToInspect1"/>
		  <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerQuestPOIToInspect2"/>
		  <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerQuestPOIToInspect3"/>
		  <Action_LockQuestTarget TargetVarName="$QuestPOIToInspect1" LockOption="Unlock"/>
		  <Action_LockQuestTarget TargetVarName="$QuestPOIToInspect2" LockOption="Unlock"/>
		  <Action_LockQuestTarget TargetVarName="$QuestPOIToInspect3" LockOption="Unlock"/>
		  <Action_LockQuestTarget TargetVarName="$InitialVillagePointOfInterest" LockOption="Unlock"/>
		  <Action_UpdateQuest State="Failed"/>
		</Controller_Sequence>

		<!--Step 1 - Fail Conditions - Villages destroyed -->
		<Controller_Sequence>
		  <Decorator_VillagesDestroyed VillagesVarName="$QuestVillageToInspect1" Initiator="AllEmpires"/>
		  <Action_UpdateQuest State="Failed"/>
		  <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerQuestPOIToInspect1"/>
		  <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerQuestPOIToInspect2"/>
		  <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerQuestPOIToInspect3"/>
		  <Action_LockQuestTarget TargetVarName="$QuestPOIToInspect1" LockOption="Unlock"/>
		  <Action_LockQuestTarget TargetVarName="$QuestPOIToInspect2" LockOption="Unlock"/>
		  <Action_LockQuestTarget TargetVarName="$QuestPOIToInspect3" LockOption="Unlock"/>
		  <Action_LockQuestTarget TargetVarName="$InitialVillagePointOfInterest" LockOption="Unlock"/>
		</Controller_Sequence>
		<Controller_Sequence>
		  <Decorator_VillagesDestroyed VillagesVarName="$QuestVillageToInspect2" Initiator="AllEmpires"/>
		  <Action_UpdateQuest State="Failed"/>
		  <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerQuestPOIToInspect1"/>
		  <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerQuestPOIToInspect2"/>
		  <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerQuestPOIToInspect3"/>
		  <Action_LockQuestTarget TargetVarName="$QuestPOIToInspect1" LockOption="Unlock"/>
		  <Action_LockQuestTarget TargetVarName="$QuestPOIToInspect2" LockOption="Unlock"/>
		  <Action_LockQuestTarget TargetVarName="$QuestPOIToInspect3" LockOption="Unlock"/>
		  <Action_LockQuestTarget TargetVarName="$InitialVillagePointOfInterest" LockOption="Unlock"/>
		</Controller_Sequence>
		<Controller_Sequence>
		  <Decorator_VillagesDestroyed VillagesVarName="$QuestVillageToInspect3" Initiator="AllEmpires"/>
		  <Action_UpdateQuest State="Failed"/>
		  <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerQuestPOIToInspect1"/>
		  <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerQuestPOIToInspect2"/>
		  <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerQuestPOIToInspect3"/>
		  <Action_LockQuestTarget TargetVarName="$QuestPOIToInspect1" LockOption="Unlock"/>
		  <Action_LockQuestTarget TargetVarName="$QuestPOIToInspect2" LockOption="Unlock"/>
		  <Action_LockQuestTarget TargetVarName="$QuestPOIToInspect3" LockOption="Unlock"/>
		  <Action_LockQuestTarget TargetVarName="$InitialVillagePointOfInterest" LockOption="Unlock"/>
		</Controller_Sequence>

        <!--Fail Condition - initial village pacified-->
        <Controller_Sequence>
          <Decorator_VillagesPacified VillagesVarName="$InitialVillage" Initiator="AllEmpires"/>
          <Action_UpdateQuest State="Failed"/>
          <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerInitialVillagePointOfInterest" />
          <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerQuestPOIToInspect1"/>
          <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerQuestPOIToInspect2"/>
          <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerQuestPOIToInspect3"/>
          <Action_LockQuestTarget TargetVarName="$QuestPOIToInspect1" LockOption="Unlock"/>
          <Action_LockQuestTarget TargetVarName="$QuestPOIToInspect2" LockOption="Unlock"/>
          <Action_LockQuestTarget TargetVarName="$QuestPOIToInspect3" LockOption="Unlock"/>
          <Action_LockQuestTarget TargetVarName="$InitialVillagePointOfInterest" LockOption="Unlock"/>
        </Controller_Sequence>

        <!--Fail Condition - initial village destroyed-->
        <Controller_Sequence>
          <Decorator_VillagesDestroyed VillagesVarName="$InitialVillage" Initiator="AllEmpires"/>
          <Action_UpdateQuest State="Failed"/>
          <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerInitialVillagePointOfInterest" />
          <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerQuestPOIToInspect1"/>
          <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerQuestPOIToInspect2"/>
          <Action_RemoveQuestMarker TargetQuestMarkerVarName="$QuestMarkerQuestPOIToInspect3"/>
          <Action_LockQuestTarget TargetVarName="$QuestPOIToInspect1" LockOption="Unlock"/>
          <Action_LockQuestTarget TargetVarName="$QuestPOIToInspect2" LockOption="Unlock"/>
          <Action_LockQuestTarget TargetVarName="$QuestPOIToInspect3" LockOption="Unlock"/>
          <Action_LockQuestTarget TargetVarName="$InitialVillagePointOfInterest" LockOption="Unlock"/>
        </Controller_Sequence>

      </Controller_Parallel>

    </Controller_Sequence>

    <!--============ REWARDS ============-->
    <Steps>
      <Step Name="SideQuestLore#0020-Step1">
        <Reward Droplist="DroplistMadFairiesMainQuestRewards" Picks="1"/>
        <ProgressionRange StartValue="0" EndValue="3"/>
      </Step>
      <Step Name="SideQuestLore#0020-Step2">
        <Reward Droplist="DroplistDust" Picks="1"/>
        <Reward LocalizationKey="%Pacification"/>
      </Step>
    </Steps>

  </QuestDefinition>

</Datatable>
